;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="102b3784-a7b2-2185-1040-0c24c573bb97")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,768834,e=>{"use strict";var t=e.i(271645);let r=e=>{let t,r=new Set,a=(e,a)=>{let o="function"==typeof e?e(t):e;if(!Object.is(o,t)){let e=t;t=(null!=a?a:"object"!=typeof o||null===o)?o:Object.assign({},t,o),r.forEach(r=>r(t,e))}},o=()=>t,s={setState:a,getState:o,getInitialState:()=>n,subscribe:e=>(r.add(e),()=>r.delete(e))},n=t=e(a,o,s);return s},a=e=>{let a=e?r(e):r,o=e=>(function(e,r=e=>e){let a=t.default.useSyncExternalStore(e.subscribe,t.default.useCallback(()=>r(e.getState()),[e,r]),t.default.useCallback(()=>r(e.getInitialState()),[e,r]));return t.default.useDebugValue(a),a})(a,e);return Object.assign(o,a),o},o=e=>e?a(e):a;e.s(["create",()=>o],768834)},471512,e=>{"use strict";var t=e.i(52563),r=e.i(954616),a=e.i(266027),o=e.i(912598),s=e.i(618566),n=e.i(604570),i=e.i(846696),l=e.i(268580),u=e.i(394073),c=e.i(647163);e.i(148059);var d=e.i(601655);let p=({teamId:e,groupId:a})=>{let{getAccessTokenSilently:i}=(0,t.useAuth0)(),d=(0,o.useQueryClient)(),p=(0,s.useRouter)();return(0,r.useMutation)({mutationFn:async({workflowId:t,type:r,navigate:o})=>{let s,f=await i(),m=`${u.BASE_API}/workflows/${t}/duplicate`;"child"===r&&(s=l.workflowService.generateName("child"));let h={type:r,name:s};e&&(h.team_id=e),a&&(h.group_id=a);let y=await (0,c.customFetch)(m,{headers:{Authorization:`Bearer ${f}`,"Content-Type":"application/json"},method:"POST",body:JSON.stringify(h)});if(!y.ok)throw await y.json();let w=await y.json();if(o){n.default.capture("workflows:run",{workflowId:w.id,type:"template"});let t=l.workflowService.getWorkflowUrl(w.id,e,a);p.push(t)}else await d.refetchQueries({queryKey:["workflows"]});return w}})},f={teamId:void 0,groupId:void 0,type:"templates"},m=e=>["workflows",e],h=e=>["workflow",e,"reports"];e.s(["getListWorkflowsQueryKey",0,m,"useBenchmarkRun",0,({runId:e,enabled:r=!0})=>{let{getAccessTokenSilently:o}=(0,t.useAuth0)();return(0,a.useQuery)({queryKey:["benchmarks/run",e],queryFn:async()=>{if(!e)throw Error("runId required");let t=await o();return(0,d.getBenchmarkRun)(e,t)},enabled:r&&!!e})},"useCancelBenchmarkRun",0,()=>{let{getAccessTokenSilently:e}=(0,t.useAuth0)(),a=(0,o.useQueryClient)();return(0,r.useMutation)({mutationFn:async({runId:t,groupId:r})=>{let a=await e();return await (0,d.cancelBenchmarkRun)(t,a),{runId:t,groupId:r}},onSuccess:(e,{groupId:t})=>{a.invalidateQueries({queryKey:["benchmarks/group",t]}),i.toast.success("Benchmark cancelled")},onError:()=>{i.toast.error("Failed to cancel benchmark")}})},"useConvertConversationToNotebookWithSchedule",0,()=>{let{getAccessTokenSilently:e}=(0,t.useAuth0)();return(0,r.useMutation)({mutationFn:async t=>{let r=await e();return await (0,d.convertConversationToNotebookWithSchedule)(t,r)}})},"useConvertMessageToCron",0,()=>{let{getAccessTokenSilently:e}=(0,t.useAuth0)();return(0,r.useMutation)({mutationFn:async({conversationId:t,messageId:r})=>{let a=await e();return await (0,d.convertMessageToCron)(t,r,a)}})},"useCreateWorkflow",0,({teamId:e,groupId:a}={})=>{let{getAccessTokenSilently:i}=(0,t.useAuth0)(),u=(0,s.useRouter)(),c=(0,o.useQueryClient)(),{mutateAsync:f}=p({teamId:e,groupId:a});return(0,r.useMutation)({mutationKey:["workflow/create"],mutationFn:async({payload:t,redirect:r,from:o})=>{let s,p=await i(),m=l.workflowService.generateName(t.type);if("parent"===t.type){let i=[l.workflowService.createDefaultStep("file-upload"),l.workflowService.createDefaultStep("ai-prompt")];s=await (0,d.createWorkflow)({defaultSteps:i,name:m,teamId:e,groupId:a,accessToken:p,type:"parent"}),n.default.capture("workflows:template:create",{workflowId:s.id,from:o,type:t.type}),r&&u.push(l.workflowService.getWorkflowUrl(s.id,e,a))}else if("child"===t.type){let o=await f({workflowId:t.parentId,type:"child"});n.default.capture("workflows:run:create",{workflowId:o.id}),c.refetchQueries({queryKey:["workflows/runs",t.parentId,e,a]}),r&&u.push(l.workflowService.getWorkflowUrl(o.id,e,a))}return s},onSuccess:(t,{payload:r})=>{c.invalidateQueries({queryKey:m({teamId:e,groupId:a,type:"parent"===r.type?"templates":"runs"})})}})},"useCreateWorkflowCron",0,()=>{let{getAccessTokenSilently:e}=(0,t.useAuth0)(),a=(0,o.useQueryClient)();return(0,r.useMutation)({mutationFn:async t=>{let r=await e();return await (0,d.createWorkflowCron)(t,r)},onSuccess:e=>{a.invalidateQueries({queryKey:["workflows/crons"]}),a.invalidateQueries({queryKey:["workflows/cron",e.content_id]}),a.invalidateQueries({queryKey:m({type:"schedule"}),exact:!1}),i.toast.success("Schedule created successfully")},onError:()=>{i.toast.error("Failed to create schedule")}})},"useDeleteWorkflowCron",0,()=>{let{getAccessTokenSilently:e}=(0,t.useAuth0)(),a=(0,o.useQueryClient)();return(0,r.useMutation)({mutationFn:async({cronId:t,workflowId:r})=>{let a=await e();return await (0,d.deleteWorkflowCron)(t,a),{cronId:t,workflowId:r}},onSuccess:(e,{workflowId:t})=>{a.invalidateQueries({queryKey:["workflows/crons"]}),a.invalidateQueries({queryKey:["workflows/cron",t]}),a.invalidateQueries({queryKey:m({type:"schedule"}),exact:!1}),i.toast.success("Schedule deleted successfully")},onError:()=>{i.toast.error("Failed to delete schedule")}})},"useDeleteWorkflowReport",0,()=>{let{getAccessTokenSilently:e}=(0,t.useAuth0)(),a=(0,o.useQueryClient)(),n=(0,s.useRouter)();return(0,r.useMutation)({mutationFn:async({workflowId:t,reportId:r,shouldRedirect:a})=>{let o=await e();await (0,d.deleteWorkflowReport)(t,r,o),a&&n.push(`/workflows/${t}/reports`)},onSuccess:(e,{workflowId:t})=>{a.invalidateQueries({queryKey:h(t)}),i.toast.success("Report deleted successfully")},onError:e=>{i.toast.error("Failed to delete report")}})},"useDuplicateWorkflow",0,p,"useExecuteBenchmark",0,()=>{let{getAccessTokenSilently:e}=(0,t.useAuth0)(),a=(0,o.useQueryClient)();return(0,r.useMutation)({mutationFn:async({workflowIds:t,teamId:r,groupId:a,executionsPerTemplate:o,name:s})=>{let n=await e();return(0,d.executeBenchmark)({workflowIds:t,teamId:r,groupId:a,executionsPerTemplate:o,name:s,accessToken:n})},onSuccess:(e,{groupId:t})=>{a.invalidateQueries({queryKey:["benchmarks/group",t]})},onError:e=>{let t=e instanceof Error?e.message:"Failed to start benchmark";i.toast.error("Failed to start benchmark",{description:t})}})},"useGenerateWorkflowReport",0,()=>{let{getAccessTokenSilently:e}=(0,t.useAuth0)(),a=(0,o.useQueryClient)(),n=(0,s.useRouter)();return(0,r.useMutation)({mutationFn:async({workflowId:t,instructions:r,shouldRedirect:a=!0})=>{let o=await e(),s=await (0,d.generateWorkflowReport)(t,r,o);s.report&&a&&n.push(`/workflows/${t}/reports/${s.report.id}`)},onSuccess:(e,{workflowId:t})=>{a.invalidateQueries({queryKey:h(t)})},onError:e=>{i.toast.error("Failed to generate report")}})},"useGroupBenchmarks",0,({groupId:e,enabled:r=!0})=>{let{getAccessTokenSilently:o}=(0,t.useAuth0)();return(0,a.useQuery)({queryKey:["benchmarks/group",e],queryFn:async()=>{if(!e)return[];let t=await o();return(0,d.getGroupBenchmarks)(e,t)},enabled:r&&!!e})},"useListWorkflows",0,(e=f)=>{let{getAccessTokenSilently:r}=(0,t.useAuth0)(),o="latest"===(0,s.useSearchParams)().get("action"),n=(0,s.useRouter)();return(0,a.useQuery)({queryKey:m(e),queryFn:async()=>{let t=await r(),a=await (0,d.getWorkflows)({...e,accessToken:t});if(o&&a.length){let t=a.sort((e,t)=>new Date(t.updated_at).getTime()-new Date(e.updated_at).getTime())[0];if(t){let r=l.workflowService.getWorkflowUrl(t.id,e.teamId,e.groupId);n.push(r)}}return a},staleTime:3e5,refetchOnMount:!1,refetchOnWindowFocus:!1,refetchOnReconnect:!1})},"useUpdateWorkflowCron",0,()=>{let{getAccessTokenSilently:e}=(0,t.useAuth0)(),a=(0,o.useQueryClient)();return(0,r.useMutation)({mutationFn:async({cronId:t,params:r})=>{let a=await e();return await (0,d.updateWorkflowCron)({...r,cron_id:t},a)},onSuccess:e=>{a.invalidateQueries({queryKey:["workflows/crons"]}),a.invalidateQueries({queryKey:["workflows/cron",e.content_id]}),a.invalidateQueries({queryKey:m({type:"schedule"}),exact:!1}),i.toast.success("Schedule updated successfully")},onError:()=>{i.toast.error("Failed to update schedule")}})},"useUploadWorkflowImage",0,()=>{let{getAccessTokenSilently:e}=(0,t.useAuth0)();return(0,r.useMutation)({mutationFn:async({file:t,workflowId:r})=>{let a=await e();try{let e=new FormData;e.append("image",t);let o=await (0,d.getURLForWorkflowImage)(e,r,a);if(!o?.image_url)throw Error("Failed to upload image");return o.image_url}catch(e){throw i.toast.error("Failed to upload image"),e}}})},"useWorkflowCrons",0,({teamId:e,groupId:r})=>{let{getAccessTokenSilently:o}=(0,t.useAuth0)();return(0,a.useQuery)({queryKey:["workflows/crons",e,r].filter(Boolean),queryFn:async()=>{let t=await o();return(await (0,d.listWorkflowCrons)(t,e,r)).crons||[]},staleTime:3e5})},"useWorkflowReport",0,(e,r)=>{let{getAccessTokenSilently:o}=(0,t.useAuth0)();return(0,a.useQuery)({queryKey:["workflow",e,"reports",r],queryFn:async()=>{if(!e||!r)return null;let t=await o(),a=await (0,d.getWorkflowReport)(e,r,t);return a.report?a.report:null},enabled:!!e&&!!r})},"useWorkflowReports",0,e=>{let{getAccessTokenSilently:r}=(0,t.useAuth0)();return(0,a.useQuery)({queryKey:h(e),queryFn:async()=>{if(!e)return{reports:[]};try{let t=await r(),a=await (0,d.getWorkflowReports)(e,t);if(a&&"object"==typeof a){if("reports"in a&&Array.isArray(a.reports))return{reports:a.reports};if(Array.isArray(a))return{reports:a}}return{reports:[]}}catch(e){return console.error("Error fetching notebook reports:",e),{reports:[]}}},enabled:!!e})}])},148059,e=>{"use strict";var t=e.i(394073),r=e.i(647163);let a=async({message:e,conversationId:a,accessToken:o})=>{let s=await (0,r.customFetch)(`${t.BASE_API}/api/shakuni/insert_message`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`,"conversation-id":a},body:JSON.stringify({message:e,conversation_id:a})});if(!s.ok)throw await s.json();return await s.json()},o=async(e,a)=>{let o=await (0,r.customFetch)(`${t.BASE_API}/api/chat/conversations/${e}/messages`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`}});if(!o.ok)throw await o.json();return await o.json()},s=async(e,a)=>{let o=await (0,r.customFetch)(`${t.BASE_API}/api/chat/conversation_from_message_id/${e}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`}});if(!o.ok)throw await o.json();return await o.json()},n=async(e,a,o)=>{let s=await (0,r.customFetch)(`${t.BASE_API}/api/cleaning/explanations/${a}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({type:o})});if(!s.ok)throw await s.json();return await s.json()},i=async(e,a,o)=>{let s=await (0,r.customFetch)(`${t.BASE_API}/api/cleaning/one_line_explanations/${a}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({errors:o,reason:"explain_error_in_one_line"})});if(!s.ok)throw await s.json();return await s.json()},l=async({messageId:e,dfSelectorIndex:a,desiredFileType:o="CSV",accessToken:s})=>{let n=await (0,r.customFetch)(`${t.BASE_API}/api/cleaning/download_dataframe`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({message_id:e,df_selector_index:a,desired_file_type:o})});if(!n.ok)throw await n.json();let i=await n.json();if(i.error)throw Error(i.error);return i};e.s(["getConversationFromMessageId",0,s,"getDownloadDataframeLink",0,l,"getMessagesByConversationId",0,o,"getOneLineErrorExplanation",0,i,"getToolExplanation",0,n,"insertMessageInConversation",0,a])},191774,e=>{"use strict";let t=(0,e.i(475254).default)("database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);e.s(["default",()=>t])},658041,e=>{"use strict";var t=e.i(191774);e.s(["Database",()=>t.default])},758472,541086,e=>{"use strict";var t=e.i(475254);let r=(0,t.default)("code",[["path",{d:"m16 18 6-6-6-6",key:"eg8j8"}],["path",{d:"m8 6-6 6 6 6",key:"ppft3o"}]]);e.s(["Code",()=>r],758472);let a=(0,t.default)("text-cursor-input",[["path",{d:"M12 20h-1a2 2 0 0 1-2-2 2 2 0 0 1-2 2H6",key:"1528k5"}],["path",{d:"M13 8h7a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2h-7",key:"13ksps"}],["path",{d:"M5 16H4a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h1",key:"1n9rhb"}],["path",{d:"M6 4h1a2 2 0 0 1 2 2 2 2 0 0 1 2-2h1",key:"1mj8rg"}],["path",{d:"M9 6v12",key:"velyjx"}]]);e.s(["TextCursorInput",()=>a],541086)},997625,990397,e=>{"use strict";let t=(0,e.i(475254).default)("code-xml",[["path",{d:"m18 16 4-4-4-4",key:"1inbqp"}],["path",{d:"m6 8-4 4 4 4",key:"15zrgr"}],["path",{d:"m14.5 4-5 16",key:"e7oirm"}]]);e.s(["default",()=>t],990397),e.s(["Code2",()=>t],997625)},268580,720858,e=>{"use strict";var t,r,a,o=e.i(843476),s=e.i(643531),n=e.i(758472),i=e.i(997625),l=e.i(658041),u=e.i(475254);let c=(0,u.default)("message-circle-code",[["path",{d:"m10 9-3 3 3 3",key:"1oro0q"}],["path",{d:"m14 15 3-3-3-3",key:"bz13h7"}],["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]]),d=(0,u.default)("list-indent-increase",[["path",{d:"M21 5H11",key:"us1j55"}],["path",{d:"M21 12H11",key:"wd7e0v"}],["path",{d:"M21 19H11",key:"saa85w"}],["path",{d:"m3 8 4 4-4 4",key:"1a3j6y"}]]),p=(0,u.default)("text-initial",[["path",{d:"M15 5h6",key:"1pr8yx"}],["path",{d:"M15 12h6",key:"upa0zy"}],["path",{d:"M3 19h18",key:"awlh7x"}],["path",{d:"m3 12 3.553-7.724a.5.5 0 0 1 .894 0L11 12",key:"6lvno8"}],["path",{d:"M3.92 10h6.16",key:"1tl8ex"}]]);var f=e.i(541086),m=e.i(846696),h=e.i(614677),y=e.i(602246),w=e.i(384347),g=e.i(842405),_=((t={}).IDLE="idle",t.QUEUED="queued",t.WAITING="waiting",t.RUNNING="running",t.COMPLETED="completed",t.ERRORED="errored",t.INTERRUPTED="interrupted",t.INTERRUPTING="interrupting",t),k=((r={}).FILE_UPLOAD="file-upload",r.USER_INPUT="user-input",r.GENERATION="generation",r),v=((a={}).NOT_STARTED="not-started",a.IS_STARTED="is-started",a.IS_COMPLETED="is-completed",a.IS_ERRORED="is-errored",a);e.s(["PhaseStatus",()=>v,"PhaseType",()=>k,"WorkflowCellStatus",()=>_],720858);let S={"ai-prompt":{role:w.WorkflowRole.agent,inputType:w.WorkflowInputType.text,value:"ai-prompt",title:"Prompt",description:"Tell Julius to run an analysis",Icon:d},"file-upload":{role:w.WorkflowRole.user,inputType:w.WorkflowInputType.file,value:"file-upload",title:"Source",description:"Give data sources to Julius",Icon:l.Database},markdown:{role:w.WorkflowRole.markdown,inputType:w.WorkflowInputType.text,value:"markdown",title:"Text",description:"Helpful markdown for the user",Icon:p},"user-prompt":{role:w.WorkflowRole.user,inputType:w.WorkflowInputType.text,value:"user-prompt",title:"User Input",description:"Ask the user to respond",Icon:f.TextCursorInput},"user-code":{role:w.WorkflowRole.user,inputType:w.WorkflowInputType.code,value:"user-code",title:"Code",description:"Tell Julius to run code",Icon:i.Code2},"eval-prompt":{role:w.WorkflowRole.evaluation,inputType:w.WorkflowInputType.text,value:"eval-prompt",title:"Evaluation",description:"Evaluate the user's response",Icon:s.Check},"sql-editor-prompt":{role:w.WorkflowRole.sqlEditor,inputType:w.WorkflowInputType.text,value:"sql-editor-prompt",title:"SQL Editor",description:"Tell Julius to query your database",Icon:c}},T=[{value:"python",label:"Python",icon:n.Code},{value:"r",label:"R",icon:n.Code},{value:"sql",label:"SQL",icon:l.Database}],E=async(e,t=1e3)=>{for(;;){try{let t=await e();if(t)return t}catch(e){}await new Promise(e=>setTimeout(e,t))}},I=e=>{if(e){let t=S["ai-prompt"],r=Object.values(S);if((t=r.find(t=>t.role===e.role&&t.inputType===e.userInputType))||(t=r.find(e=>e.role===w.WorkflowRole.agent)))return t;if(e.role===w.WorkflowRole.user&&e.userInputType===w.WorkflowInputType.text)return r.find(e=>"ai-prompt"===e.value)}return S["ai-prompt"]},A=e=>{switch(I(e).value){case"ai-prompt":default:return{[k.GENERATION]:{type:k.GENERATION,status:v.NOT_STARTED}};case"file-upload":return{[k.FILE_UPLOAD]:{type:k.FILE_UPLOAD,status:v.NOT_STARTED},[k.GENERATION]:{type:k.GENERATION,status:v.NOT_STARTED}};case"user-prompt":return{[k.USER_INPUT]:{type:k.USER_INPUT,status:v.NOT_STARTED},[k.GENERATION]:{type:k.GENERATION,status:v.NOT_STARTED}}}},b=(e,t)=>C(e).plan.steps.find(e=>e.id===t),C=e=>{let t=(0,y.getWorkflowQueryKey)(e);return g.client.getQueryData(t)};e.s(["workflowService",0,{parseWorkflowError:e=>{let t="object"==typeof e?e.error:void 0,r="object"==typeof e?e.message:void 0;return t||r||"We're unable to run this cell."},getPersistentCellStatus:e=>{switch(e){case _.RUNNING:case _.QUEUED:case _.WAITING:return _.IDLE;case _.INTERRUPTING:return _.INTERRUPTED;default:return e}},scrollToCell:(e,t)=>{e?.current?.scrollToIndex({index:t,behavior:"smooth",align:"start",offset:-65})},getWorkflowUrl:(e,t,r)=>{let a="";return t&&(a=`/team/${t}`),r&&t&&(a=`/team/${t}/group/${r}`),a+="/notebooks",e&&(a+=`/${e}`),a},getWorkflow:C,cellTypes:S,cellOptions:e=>[S["ai-prompt"],S["file-upload"],S["user-prompt"],S["user-code"],S.markdown,...e?[S["sql-editor-prompt"],S["eval-prompt"]]:[]],getCellStyle:e=>e.role===w.WorkflowRole.markdown?"markdown":"default",getCellType:I,createDefaultStep:(e,t={})=>{let r=S[e],a={display:"",display_prompt:"",content:"",id:(0,h.v4)(),role:r.role,userInputType:r.inputType,status:_.IDLE,type:r.value,phases:void 0,metadata:{}},o=A(a),s=Object.fromEntries(Object.entries(t).filter(([e,t])=>!!t));return{...a,phases:o,...s}},insertStepAtIndex:(e,t,r)=>{let a=r<0||r>e.length?e.length:r;return[...e.slice(0,a),t,...e.slice(a)]},removeStepAtIndex:(e,t)=>[...e.slice(0,t),...e.slice(t+1)],moveStepByIndex:(e,t,r)=>{let a=e.slice(),o=a.splice(t,1)[0];return a.splice(r,0,o),a},updateStepById:(e,t,r)=>{let a=C(e);if(!a)return[];let o=b(e,t);if(!o)return a.plan.steps;let s={};return s="function"==typeof r?r(o):r??{},a.plan.steps.map(e=>e.id===t?{...e,...s}:e)},updateCellById:(e,t,r)=>e.map(e=>e.id===t?{...e,...r}:e),getStepById:b,getDefaultCellPhases:A,getIndexbyStepId:(e,t)=>{let r=C(e),a=r?.plan.steps.findIndex(e=>e.id===t);if(-1!==a)return a},filterMessagesByStepId:(e,t)=>e.filter(e=>e.plan_step_id===t),getAcessRole:(e,t,r,a,o)=>{if(!e)return;if(window.location.pathname.includes("/s/"))return"viewer";if(r?.email===e?.creator?.email)return"editor";if(!t)return"viewer";let s=t.members.find(e=>r&&e.user?.email===r?.email);if(s)return s.role;if(t.groups&&o){let e=t.groups.find(e=>e.group.id&&(o??[]).find(t=>t.group_id===e.group.id));if(e)return e.role}let n=t.teams.find(e=>e.team.id&&a?.details?.id);return n?n.role:"viewer"},generateName:e=>{let t=new Date,r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()],a=t.getDate(),o=t.getFullYear(),s=t.getHours().toString().padStart(2,"0"),n=t.getMinutes().toString().padStart(2,"0"),i=t.getSeconds().toString().padStart(2,"0"),l=`${s}:${n}:${i}`;return`${r}-${a}-${o}-${l}`},retry:E,getIsOwner:(e,t)=>e?.creator?.email===t?.email,cellPhaseToState:(e,t)=>{if(!e||!(t in e))return{isPending:!1,isSuccess:!1,isError:!1};let r=e[t],a=r&&r.status===v.IS_STARTED;return{isPending:a,isSuccess:r&&r.status===v.IS_COMPLETED,isError:r&&r.status===v.IS_ERRORED}},disconnectedToast:()=>{m.toast.info("You are not connected to the notebook.",{description:(0,o.jsxs)("div",{className:"prose-sm",children:[(0,o.jsx)("span",{children:"This can happen for a number of reasons: "}),(0,o.jsxs)("ul",{className:"list-disc",children:[(0,o.jsx)("li",{children:"You do not have permission to edit."}),(0,o.jsx)("li",{children:"You are disconnected from the internet."}),(0,o.jsx)("li",{children:"You lost connection to the notebook."})]})]})})},errorToast:e=>{m.toast.error(e.title,{description:e.description})},codeLanguages:T}],268580)},150509,e=>{"use strict";var t=e.i(52563),r=e.i(954616),a=e.i(266027),o=e.i(618566),s=e.i(38037),n=e.i(620949),i=e.i(148059);let l=e=>{if("function"===e.role)try{let t=JSON.parse(e.content);t.outputs_dict&&Object.entries(t.outputs_dict).forEach(([e,t])=>{s.globalOutputsDict[e]=t}),t.image_urls_dict&&Object.entries(t.image_urls_dict).forEach(([e,t])=>{s.globalImageUrlsDict[e]=t})}catch(e){console.error(e)}},u=async(e,t,r,a)=>{let o=await (0,i.getMessagesByConversationId)(e,t);return o.forEach(l),(a?.hide_code||r.includes("/s/notebooks"))&&(o=o.map(e=>({...e,isCollapsed:!0}))),o};e.s(["useConversationMessages",0,(e,r)=>{let{getAccessTokenSilently:s,isAuthenticated:i}=(0,t.useAuth0)(),{data:l}=(0,n.useUserInformation)(),c=(0,o.usePathname)();return(0,a.useQuery)({queryKey:["conversation/messages",e],queryFn:async()=>{let t="";return i&&(t=await s()),u(e,t,c,i?l?.preferences:void 0)},enabled:!!e,staleTime:1/0,retry:!1,refetchOnWindowFocus:!1,...r})},"useDownloadDataframeMutation",0,()=>{let{getAccessTokenSilently:e}=(0,t.useAuth0)();return(0,r.useMutation)({mutationFn:async({messageId:t,dfSelectorIndex:r,desiredFileType:a="CSV"})=>{let o=await e();return(0,i.getDownloadDataframeLink)({messageId:t,dfSelectorIndex:r,desiredFileType:a,accessToken:o})}})},"useOneLineErrorExplanationQuery",0,({messageId:e,errors:r,enabled:o=!0})=>{let{getAccessTokenSilently:s,isAuthenticated:n}=(0,t.useAuth0)();return(0,a.useQuery)({queryKey:["oneLineErrorExplanation",e,r],queryFn:async()=>{let t="";return n&&(t=await s()),(0,i.getOneLineErrorExplanation)(t,e,r)},enabled:o})},"useToolExplanationQuery",0,({messageId:e,type:r,enabled:o=!0})=>{let{getAccessTokenSilently:s,isAuthenticated:n}=(0,t.useAuth0)();return(0,a.useQuery)({queryKey:["toolExplanation",e,r],queryFn:async()=>{let t="";return n&&(t=await s()),(0,i.getToolExplanation)(t,e,r)},enabled:o})}])},889435,e=>{"use strict";var t=e.i(247167),r=e.i(662537),a=e.i(678631),o=e.i(394073),s=e.i(647163);let n=async({accessToken:e})=>{let t=await (0,s.customFetch)(`${o.BASE_API}/hub/v2/list_hub_files`,{headers:{Authorization:`Bearer ${e}`}});if(!t.ok)throw Error("Failed to fetch files");let r=await t.json();if(r.files)return r.files.map(e=>({...e,type:"temporary"}));throw Error("No 'files' in response JSON")},i=async({accessToken:e,teamId:t,groupId:r})=>{let a=await (0,s.customFetch)(`${o.BASE_API}/teams/${t}/groups/${r}/files`,{headers:{Authorization:`Bearer ${e}`}});if(!a.ok)throw await a.json();return await a.json()},l=async({accessToken:e,teamId:t})=>{let r=await (0,s.customFetch)(`${o.BASE_API}/teams/${t}/files`,{headers:{Authorization:`Bearer ${e}`}});if(!r.ok)throw await r.json();return await r.json()},u=async({accessToken:e,filename:t,fileType:r,pastedText:a,useTeamServer:n=!1})=>{let i=await (0,s.customFetch)(`${o.BASE_API}/files/signed_url${n?"?team_server=true":""}`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({filename:t,mimeType:"application/vnd.ms-excel"===r?"text/csv":r,pastedText:a})});if(!i.ok)throw Error(`Failed to get signed URL: ${i.statusText}`);return await i.json()},c=async({accessToken:e,file:r,filename:a})=>{let n=new FormData;n.append("file",r,a);let i=await (0,s.customFetch)(`${o.BASE_API}/files/upload_multipart`,{method:"POST",headers:{Authorization:`Bearer ${e}`,Renamable:"true","Preview-On-Attach":"true","Is-Demo":localStorage.getItem("tempUserId")||"","Is-Native":t.default.env.NEXT_PUBLIC_NATIVE||"false","Expected-Name":a},body:n});if(!i.ok)throw await i.json();return await i.json()},d=async(e,t,r,a)=>{let n=await (0,s.customFetch)(`${o.BASE_API}/files/preprocess_file`,{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({filename:e,conversationId:r,analyze:t})});if(!n.ok)throw await n.json();return await n.json()},p=async({accessToken:e,filepath:t,teamId:r,mimeType:a})=>{let n=await (0,s.customFetch)(`${o.BASE_API}/teams/${r}/files`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({filepath:t,mimeType:a||"application/octet-stream"})});if(!n.ok)throw await n.json();return await n.json()},f=async({accessToken:e,fileId:t,teamId:r})=>{let a=await (0,s.customFetch)(`${o.BASE_API}/teams/${r}/files/${t}`,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!a.ok)throw await a.json();return await a.json()},m=async({accessToken:e,teamId:t,filepath:r})=>{let a=await (0,s.customFetch)(`${o.BASE_API}/teams/${t}/files/metadata`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({object_key:r})});if(!a.ok)throw await a.json();return await a.json()},h=async({accessToken:e,fileId:t,teamId:r})=>{let a=await (0,s.customFetch)(`${o.BASE_API}/teams/${r}/files/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!a.ok)throw await a.json();return await a.json()},y=async({filename:e,filepath:t,accessToken:r})=>{let a=await (0,s.customFetch)(`${o.BASE_API}/hub/delete_hub_files`,{headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},method:"DELETE",body:t?JSON.stringify({filepath:t,filename:e}):JSON.stringify({filename:e})});if(!a.ok)throw await a.json();return await a.json()},w=async({accessToken:e,fileId:t,filename:r,teamId:o})=>{let s=await f({accessToken:e,fileId:t,teamId:o}),n=await fetch(s);if(!n.ok)throw Error("Failed to download file");let i=await n.blob();(0,a.saveAs)(i,r)},g=async({filename:e,accessToken:t})=>{let a=decodeURIComponent(e),n=await (0,s.customFetch)(`${o.BASE_API}/files/download`,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},method:"POST",body:JSON.stringify({filename:a})});if(!n.ok)throw Error("Error downloading file");let{signedUrl:i}=await n.json();if(!i)throw r.captureMessage("No signedUrl in response",{extra:{filename:a}}),Error("No signedUrl in response");return(0,s.windowHasNative)()?(0,s.sendToNative)({type:"DOWNLOAD_FILE",method:"signedUrl",fileName:a,url:i}):_(i,a),{name:a}},_=(e,t)=>{let r=document.createElement("a");r.id=`download-link-${t}`,r.href=e,r.download=t,document.body.appendChild(r),r.click(),document.body.removeChild(r)},k=async({accessToken:e,filepath:t,teamId:r,groupId:a,mimeType:n})=>{let i=await (0,s.customFetch)(`${o.BASE_API}/teams/${r}/groups/${a}/files`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({filepath:t,mimeType:n||"application/octet-stream"})});if(!i.ok)throw await i.json();return await i.json()};e.s(["deleteHubFile",0,y,"deleteTeamFile",0,h,"downloadFile",0,g,"downloadTeamFile",0,w,"getFiles",0,n,"getSignedFileUploadUrl",0,u,"getSignedTeamFileUploadUrl",0,p,"getSignedTeamGroupFileUploadUrl",0,k,"getTeamFiles",0,l,"getTeamGroupFiles",0,i,"transferFile",0,d,"uploadMultipartFile",0,c,"uploadToSignedUrl",0,({signedUrl:e,file:t,filename:r,contentType:a,onProgress:o})=>new Promise((s,n)=>{let i=new XMLHttpRequest;i.open("PUT",e,!0),i.setRequestHeader("Content-Type",a),i.upload.onprogress=e=>{e.lengthComputable&&o&&o(r,Math.round(100*e.loaded/e.total),t.size)},i.onload=()=>{i.status>=200&&i.status<300?s(i.responseText):n(Error(`Upload Error: ${i.status} ${i.statusText}`))},i.onerror=()=>{n(Error(`XHR Error: ${i.statusText}`))},i.send(t)}),"upsertTeamFileMetadata",0,m])},503861,e=>{"use strict";var t=e.i(843476),r=e.i(271645),a=e.i(912598),o=e.i(618566);e.i(971804);var s=e.i(511108),n=e.i(367944),i=e.i(52563),l=e.i(266027),u=e.i(394073),c=e.i(647163);let d=async({accessToken:e,teamStats:t=!1})=>{if(!e)throw Error("No access token provided");let r=t?"?team_stats=true":"";try{let t=`${u.BASE_API}/hub/heartbeat${r}`;u.FEATURE_FLAGS.KUBE_METRICS&&(t=`${u.BASE_API}/sandboxes/usage${r}`);let a=await (0,c.customFetch)(t,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}});if(!a.ok)throw Error("Error fetching server status");return{...await a.json(),local_timestamp:Date.now()}}catch(e){throw Error("Error fetching server status")}},p={server_status:"Offline",memory_usage:0,memory_usage_mb:0,memory_limit:0,cpu_percent:0,is_persistent:!1,persistent_available:!1,can_migrate:!1,disk_usage_mb:0,local_timestamp:0,warm_memory:!1};var f=e.i(620949);let m=(0,r.createContext)(void 0);e.s(["DataSourcesContextProvider",0,({children:e})=>{let{activeConversationId:u}=(0,n.useChatContext)(),{prepServer:c,saveExportForConversation:h,loadSavedExportForConversation:y}=(0,s.useChatAPI)(),w=(0,a.useQueryClient)(),[g,_]=(0,r.useState)("idle"),[k,v]=(0,r.useState)([]),S=(0,o.usePathname)(),[T,E]=(0,r.useState)(!1);(0,r.useEffect)(()=>{E(S.includes("/team/"))},[S]);let{data:I,refetch:A,isFetching:b}=(({disabled:e,teamStats:t=!1})=>{let[o]=(0,r.useState)(new Date().getTime()),s=(0,a.useQueryClient)(),{getAccessTokenSilently:u,isAuthenticated:c}=(0,i.useAuth0)(),{isGenerating:f}=(0,n.useChatContext)();return(0,r.useEffect)(()=>{e||s.refetchQueries({queryKey:["server/status",t]})},[e,s,t]),(0,r.useEffect)(()=>{let e=setTimeout(()=>{let e=new Date().getTime()-o>12e4,r=s.getQueryData(["server/status",t]);if(r?.server_status!=="Ready"&&e)return s.setQueryData(["server/status",t],()=>p)},12e4);return()=>clearTimeout(e)},[s,o,t]),(0,l.useQuery)({queryKey:["server/status",t],queryFn:async()=>d({accessToken:await u(),teamStats:t}),initialDataUpdatedAt:o,refetchInterval:e=>{let t=new Date().getTime(),r=e.options.initialDataUpdatedAt;if(!e.state.data&&t-r>12e4||e.state.error||e.state.fetchFailureCount>1)return!1;if(!e.state.data?.server_status)return 4e3;{let t=e.state.data.server_status;if("Offline"===t)return!1;if("Starting"===t)return 4e3;if("Ready"===t)return!!f&&5e3}return console.error("Invalid server status:",e.state.data),!1},staleTime:3e5,enabled:c})})({disabled:k.length>=3,teamStats:T});(0,r.useEffect)(()=>{I&&v(e=>{if(!e.find(e=>e.local_timestamp===I.local_timestamp)){let t=e.concat(I);return t.length>3&&t.shift(),t}return e})},[I,w]);let C=(0,r.useCallback)(()=>{w.setQueryData(["server/status",T],{...I,server_status:"Starting"});let e=setTimeout(()=>{let e=w.getQueryData(["server/status",T]);e?.server_status==="Starting"&&w.setQueryData(["server/status",T],{...e,server_status:"Offline"})},3e4);c().catch(()=>{w.setQueryData(["server/status",T],{...I,server_status:"Offline"})}),A().finally(()=>{let t=w.getQueryData(["server/status",T]);t?.server_status==="Ready"&&clearTimeout(e)})},[c,A,w,I,T]),O=(0,f.useChangeContainer)(),j=async()=>{try{_("saving state"),await h({conversationId:u}),_("provisioning the new server"),await O.mutateAsync("gcp_secondary"),await new Promise(e=>setTimeout(e,1e3)),_("prepping new server"),c(),_("waiting for new server to start"),await A(),_("loading in old data"),await y({conversationId:u}),_("idle")}catch(e){console.error("An error occurred during the migration process:",e)}finally{_("idle")}};return(0,t.jsx)(m.Provider,{value:{serverConnectionStatus:I?.server_status??"Starting",serverMemoryUsage:I?.memory_usage??0,serverMemoryMB:I?.memory_usage_mb??0,serverMemoryLimit:I?.memory_limit??0,cpuPercentage:I?.cpu_percent??0,statusHistory:k,handleNewServerStart:C,isCheckingStatus:b,refetchStatus:A,migrateServersFromEphemeralToPersistent:j,serverMigrationStatus:g,isTeamServer:T},children:e})},"useDataSourcesContext",0,()=>{let e=(0,r.useContext)(m);if(!e)throw Error("useDataSourcesContext must be used within a DataSourcesContextProvider");return e}],503861)},959143,e=>{"use strict";var t=e.i(843476),r=e.i(271645),a=e.i(604570),o=e.i(394073),s=e.i(647631),n=e.i(75510);let i=(0,r.createContext)(void 0);e.s(["BannersProvider",0,({children:e})=>{let[l,u]=(0,r.useState)(!1),[c,d]=(0,r.useState)(null),[p,f]=(0,r.useState)(null),[m,h]=(0,r.useState)(null),[y,w]=(0,r.useState)(!1),[g,_]=(0,r.useState)(null),[k,v]=(0,r.useState)(o.FEATURE_FLAGS.SIMULATION_OUTAGE),{setUserOnboarding:S}=(0,s.useUserOnboarding)(),T=(0,n.useGetCookieOnClient)("onboarding_status");return(0,r.useEffect)(()=>{"true"===T&&c>10&&(S("adapt_julius"),a.default.capture("onboarding_tracker:adapt_conversation"))},[c]),(0,t.jsx)(i.Provider,{value:{showMessagesLeftBanner:l,setShowMessagesLeftBanner:u,messagesSent:c,setMessagesSent:d,messagesAllowed:p,setMessagesAllowed:f,showFreemiumBanner:y,setShowFreemiumBanner:w,showOutageBanner:k,setShowOutageBanner:v,messagesLeft:m,setMessagesLeft:h,setServerMessagesRemaining:_,serverMessagesRemaining:g},children:e})},"useBanners",0,()=>(0,r.useContext)(i)])},210677,e=>{"use strict";var t=e.i(843476),r=e.i(271645),a=e.i(52563),o=e.i(912598),s=e.i(618566),n=e.i(604570),i=e.i(614677);e.i(971804);var l=e.i(511108),u=e.i(38037),c=e.i(330973),d=e.i(653770),p=e.i(329801),f=e.i(620949),m=e.i(959143),h=e.i(367944),y=e.i(503861),w=e.i(616525);let g=(0,r.createContext)(void 0);e.s(["MessageContextProvider",0,({children:e})=>{let _=(0,s.useRouter)(),{user:k,getAccessTokenSilently:v}=(0,a.useAuth0)(),{theme:S}=(0,w.useUserContext)(),{data:T}=(0,f.useUserSubscription)(),{setError:E,setGeneratingStatusMessage:I,conversations:A,setConversations:b,isGenerating:C,setButtons:O,attachments:j,currentUploadedImagesRef:F,activeConversationId:x,getNewImageUrls:R,modelProvider:P,setIsGenerating:$,chatMode:D,tempUserId:N,setIsAutoPlay:B,userMessageCount:M,setShowRating:U,setShowSlackCTA:W,activePlanStepId:Q,startConversation:q,setShowUpgradeBanner:L}=(0,h.useChatContext)(),{addUserEvent:K,getBotMessages:z,getMessageSuggestions:G}=(0,l.useChatAPI)(),{refetchStatus:J}=(0,y.useDataSourcesContext)(),{setModal:H,setStaleFileIds:V}=(0,d.useModal)(),{setShowFreemiumBanner:Y,setShowMessagesLeftBanner:X,setMessagesSent:Z,setMessagesAllowed:ee,setServerMessagesRemaining:et}=(0,m.useBanners)(),er=(0,o.useQueryClient)(),[ea,eo]=(0,r.useState)([]),es=async(e,t)=>{if("function"===e.role)try{let t=JSON.parse(e.content);t.outputs_dict&&Object.entries(t.outputs_dict).forEach(([e,t])=>{u.globalOutputsDict[e]=t}),t.image_urls_dict&&Object.entries(t.image_urls_dict).forEach(([e,t])=>{u.globalImageUrlsDict[e]=t})}catch(e){console.error(e)}let r=e.conversation_id||t;if(e.error){E(e.error),await K({eventName:"frontend_error",eventStatus:"error",eventSource:"client_chat",eventDetails:{...e,messageConversationId:r},stopKernel:!0});return}if(e.stream_result)return void I(e);if(I(null),"freemium"===e.alert){L(!0),7===e.num_messages?n.default.capture("upgrade_cta_shown",{type:"banner",name:"upgrade_banner_chat_7"}):n.default.capture("upgrade_cta_shown",{type:"banner",name:"upgrade_banner_chat"});return}if("rate_limit"===e.alert){if(B(!1),T?.plan==="Lite"){H("lite_upgrade"),n.default.capture("upgrade_cta_shown",{type:"modal",name:"lite_upgrade"});return}H("subscribe"),n.default.capture("upgrade_cta_shown",{type:"modal",name:"subscribe"});return}if("freemium_banner"===e.alert){Y(!0),n.default.capture("upgrade_cta_shown",{type:"banner",name:"freemium"});return}if("verify"===e.alert){B(!1),_.push("/verify");return}if("messages_left"===e.alert){X(!0),Z(e?.num_messages),ee(e?.messages_allowed),et(e?.messages_left);return}if("messages_left_for_provider"===e.alert){let t=e?.messages_left;t&&t<=15&&(X(!0),Z(e?.num_messages),ee(e?.messages_allowed),et(e?.messages_left));return}"kernel_crash"===e.alert?H("kernel_crash"):b(t=>{let a={...t},o=a[r]?.messages;if("update_last_user_message_id"===e.purpose&&o&&o.length>0){let t=-1;for(let e=o.length-1;e>=0;e--)if("user"===o[e].role){t=e;break}-1!==t&&(o[t].message_id=e.new_message_id,o[t].plan_step_id=e.plan_step_id)}if("plan"===e.purpose){let t=e.plan_message_id,o=e.plan_data,s=a[r]?.messages;if(s&&s.length>0){let e=-1;for(let r=s.length-1;r>=0;r--)if(s[r].message_id===t){e=r;break}return -1!==e&&(s[e].plan=o),a}}if(e?.current_action_id)try{let t=a[r]?.currentPlanStep;t?.action_id===e?.current_action_id?t.content+=e.content:(t.action_id=e?.current_action_id,t.content=e.content)}catch(e){console.error(e)}if(!e.id)return a;if(o&&"thinking_call"===e.purpose){let t=e.id,s=-1;for(let e=o.length-1;e>=0;e--)if(o[e].id===t){s=e;break}if(-1===s){let t={...e,content:""};a[r]?.messages?.push(t)}else{let t=a[r]?.messages?.find(t=>t.id===e.id);t&&(t.thinking_call.arguments=e.thinking_call.arguments)}return a}er.setQueryData(["conversation/messages",r],t=>{if(t||(t=[]),!e)return t;let r=[...t];if("thinking_call"===e.purpose){let t=e.id,a=-1;for(let e=r.length-1;e>=0;e--)if(r[e].id===t){a=e;break}if(-1===a)r.push({...e,content:""});else{let t=r.find(t=>t.id===e.id);t&&(t.thinking_call.arguments=e.thinking_call.arguments)}return r}let a=r?.findIndex(t=>t.message_id===e.message_id);if(-1===a)r.push({...e});else{let t=structuredClone(r[a]);t.content+=e.content,t.function_call||(t.function_call=e.function_call),t.function_call&&e.function_call?.arguments&&(t.function_call.arguments+=e.function_call.arguments),!t.completed_at&&e.completed_at&&(t.completed_at=e.completed_at),r[a]=t}return r});let s=a[r]?.messages?.find(t=>t.id===e.id);if(s)for(let t in s.content+=e.content,s.function_call||(s.function_call=e.function_call),s.function_call&&e.function_call?.arguments&&(s.function_call.arguments+=e.function_call.arguments),!s.completed_at&&e.completed_at&&(s.completed_at=e.completed_at),e)t in s||(s[t]=e[t]);else{let t={function_call:e.function_call,name:e.name,role:e.role,content:e.content||"",id:e.id,message_id:e.message_id,upvote_status:e.upvote_status,flags:e.flags,actions:e.actions,metadata:e.metadata,completed_at:e.completed_at||new Date().toISOString(),plan_step_id:Q};"missing_file"===t.actions&&(V(t.metadata?.missing_files||[]),H("file_not_found"),B(!1)),a[r]?.messages?.push(t),"manipulate_sheet"===e.name&&"function"===e.role&&(a[r].seconds="3600")}return a})},en=async(e,t)=>{G(e,t).then(e=>{e&&eo(e)})},ei=async(e,t=0,r=!1,a,o=null)=>{if(C)return;Y(!1),E(null),O([]),eo([]);let s=R(),n=e.new_attachments||j;F.current=[];let l={role:"user",content:e.content,image_urls:s?.map(e=>e.url),attachments:n,message_id:e.message_id||(0,i.v4)(),completed_at:new Date().toISOString(),step:e.workflowStep,plan_step_id:e.workflowStep?.id||Q,workflow_step_for:e?.workflow_step_for};r&&x&&(A[x]?.messages?.pop(),b({...A}));let u=a||x;if(!u){let{id:e}=await q({});u=e}a||(0,p.updateConversationWithMessage)({conversationId:u,setConversations:b,content:l,forStepId:e?.forStepId});let d=setTimeout(()=>{J()},5e3),f=new Date().getTime(),m=await (0,c.streamBotMessages)({isGenerating:C,setIsGenerating:$,userMessage:e,conversationId:u||A[Object.keys(A)[0]].id,updateMessages:es,setModal:H,setError:E,modelProvider:P,chatMode:D,theme:e?.theme||S,getBotMessages:z,newImages:s,newAttachments:n,addUserEvent:K,tempUserId:k?null:N,subscriptionPlan:T?.plan,accessToken:k?await v():null,currentTimestamp:f,juliusApp:o});return clearTimeout(d),3===M||M>5&&M%5==0?(U(!0),W(!1)):4===M||7===M||11===M?(U(!1),T?.plan&&W(!0)):(U(!1),W(!1)),$(!1),en(u,{temp:0}),m},el=async()=>{if(A[x]&&!C){Y(!1),eo([]),window.location.pathname.startsWith("/ai-math")&&n.default.capture("message-sent",{from:"/ai-math"});try{b(e=>e[x]?{...e,[x]:{...e[x],currentPlanStep:{}}}:e)}catch(e){console.error(e)}for(E(null);A[x].messages.length>0;){let e=A[x].messages.pop();if("user"===e.role){A[x].messages.push(e);break}}b({...A}),await (0,c.streamBotMessages)({isGenerating:C,setIsGenerating:$,userMessage:null,conversationId:x,updateMessages:es,setModal:H,setError:E,generationType:"regenerate",modelProvider:P,chatMode:D,theme:S,getBotMessages:z,addUserEvent:K,subscriptionPlan:T?.plan}),3===M||M>5&&M%5==0?(U(!0),W(!1)):4===M||7===M||11===M?(U(!1),T?.plan&&W(!0)):(U(!1),W(!1))}},eu=async e=>{if(C)return;Y(!1),eo([]);let t=A[x].messages,r=t.findIndex(t=>t.message_id===e.message_id);{let e=t.slice(0,r+1);b(t=>({...t,[x]:{...t[x],messages:e}}))}await (0,c.streamBotMessages)({isGenerating:C,setIsGenerating:$,userMessage:e,conversationId:x,updateMessages:es,setModal:H,setError:E,generationType:"edit_code",modelProvider:P,theme:S,getBotMessages:z,addUserEvent:K,subscriptionPlan:T?.plan}),3===M||M>5&&M%5==0?(U(!0),W(!1)):4===M||7===M||11===M?(U(!1),T?.plan&&W(!0)):(U(!1),W(!1))},ec=async e=>{if(C)return;Y(!1),eo([]);let t=A[x]?.messages;if(!t||t.length<=e.index)return;E(null);let r=t;if("user"!==t[e.index].role)return void console.error("Cannot edit that message. Index not found");r=t.map((t,r)=>r===e.index?{...t,content:e.content}:t);let a=e.messageId,o=r.findIndex(e=>e.message_id===a);-1===o?console.error("Cannot edit that message. Index not found"):(b(e=>({...e,[x]:{...e[x],messages:r.slice(0,o+1)}})),await (0,c.streamBotMessages)({isGenerating:C,setIsGenerating:$,userMessage:e,conversationId:x,updateMessages:es,setModal:H,setError:E,generationType:"edit",modelProvider:P,theme:S,getBotMessages:z,addUserEvent:K,subscriptionPlan:T?.plan}),3===M||M>5&&M%5==0?(U(!0),W(!1)):4===M||7===M||11===M?(U(!1),T?.plan&&W(!0)):(U(!1),W(!1)))};return(0,t.jsx)(g.Provider,{value:{updateMessages:es,generateBotResponse:ei,regenerateBotResponse:el,editCodeAndGenerateBotResponse:eu,editMessageAndGenerateBotResponse:ec,handleMessageCompleteActions:en,nextMessageSuggestions:ea},children:e})},"useMessageContext",0,()=>(0,r.useContext)(g)])}]);

//# debugId=102b3784-a7b2-2185-1040-0c24c573bb97
//# sourceMappingURL=1aadabfb59372a88.js.map