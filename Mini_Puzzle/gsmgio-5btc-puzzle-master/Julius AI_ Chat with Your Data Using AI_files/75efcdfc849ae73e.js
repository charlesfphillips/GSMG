;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="6e17247b-cad5-d522-cf1c-cbc4fb6d9318")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,330973,329801,15341,e=>{"use strict";var t=e.i(662537),r=e.i(604570),a=e.i(394073);let n=0,o=null,s=null,i=async()=>{if(!o)return!1;try{return s="interrupted",await o.cancel("canceling reader"),!0}catch{return!1}},u=async({isGenerating:e,setIsGenerating:i,userMessage:u,conversationId:l,updateMessages:c,setModal:d,setError:p,generationType:m="message",modelProvider:h="default",tempUserId:y=null,chatMode:g="quantitative",theme:w=null,getBotMessages:f,newImages:_,newAttachments:S,addUserEvent:v=()=>{},selectedModels:b=null,subscriptionPlan:A=null,juliusApp:C=null})=>{if(!l)return void p({title:"Conversation Error",message:`We tried to send a message before the conversation was ready. Contact ${a.FEATURE_FLAGS.SUPPORT_EMAIL} if this continues.`});let $=n+=1;if(!e)try{let e=async()=>{i(!0),r.default.capture("streaming_started",{conversationId:l,generationType:m});let e=null;s=null;try{e=await f(l,u,m,h,y,g,w,_,S,b,C)}catch(e){return i(!1),console.error("stream failed - ",e),r.default.capture("streaming_error",{conversationId:l,generationType:m,error:{message:e.message,name:e.name,stack:e.stack}}),{error:e}}if(!e.ok){console.error("stream failed - ",e),r.default.capture("streaming_error",{conversationId:l,generationType:m}),i(!1);try{let t=await e.json();if(t.error){if("rate_limit"===t.error)if(y)d("free_rate_limit");else{try{window.localStorage.setItem(`prior_subscribe_msg_${l}`,u.content)}catch(e){console.error("unhandled error - ",e),v({eventName:"frontend_error",eventStatus:"error",eventSource:"client_chat",eventDetails:{conversationId:l,error:{message:e.message,name:e.name,stack:e.stack}}})}if("Lite"===A){d("lite_upgrade"),r.default.capture("upgrade_cta_shown",{type:"modal",name:"lite_upgrade"});return}d("subscribe"),r.default.capture("upgrade_cta_shown",{type:"modal",name:"subscribe"}),d("subscribe"),r.default.capture("upgrade_cta_shown",{type:"modal",name:"subscribe"})}return{error:t.error}}}catch(e){}}if(e?.body){o=e.body.getReader();let r=new TextDecoder("utf-8"),i=!1,u="";for(;!i&&o&&$===n;)try{let{value:e,done:t}=await o.read();if(t){if(i=!0,"interrupted"===s)throw TypeError("INTERRUPTED");o&&(o?.releaseLock(),o=null);break}for(u+=r.decode(e,{stream:!0});;){let e,t=u.indexOf("\n");if(-1===t)break;let r=u.substring(0,t);try{e=JSON.parse(r)}catch(e){break}u=u.substring(t+1),e&&await c(e,l)}}catch(e){if(e instanceof TypeError&&"INTERRUPTED"===e.message)return{interrupted:!0};console.error(e),t.captureException(e),v({eventName:"frontend_error",eventStatus:"error",eventSource:"client_chat",eventDetails:{conversationId:l,error:{message:e.message,name:e.name,stack:e.stack}}}),"network error"===e.message?p({title:"Network Error",message:"There was an issue with the connection."}):p({title:"Error",message:`An unexpected error occurred. Please refresh to try again and contact ${a.FEATURE_FLAGS.SUPPORT_EMAIL} if this continues.`});break}}else r.default.capture("streaming_error",{conversationId:l,generationType:m});i(!1)};return await Promise.race([e(),new Promise((e,t)=>setTimeout(()=>t(Error("Operation timed out after 1800000 ms")),18e5))])}catch(e){if(e.message.includes("Operation timed out"))v({eventName:"streaming_timeout",eventStatus:"timeout",eventSource:"Julius",eventDetails:{conversationId:l},stopKernel:!0}),console.error("Operation timed out after 10 minutes."),p({title:"Timeout Error",message:"The operation timed out after 10 minutes. Try over a smaller chunk of your data or break it into pieces."}),i(!1);else throw e}};async function l({setConversations:e,content:t,forStepId:r,conversationId:a}){e(e=>{if(!a||!e[a])return e;let n={...e};if(n[a]&&!n[a].messages&&(n[a].messages=[]),n[a].currentPlanStep={},r){let e=n[a].messages.findIndex(e=>e.plan_step_id===r&&"userInput"===e.role);-1!==e&&(n[a].messages[e]=t)}else n[a]?.messages?.push(t);return n})}function c({property:e,value:t}){let r=new URL(window.location.toString());r.searchParams.set(e,t),window.history.pushState({},"",r)}e.s(["handleCloseConnection",0,i,"streamBotMessages",0,u],330973),e.s(["setAndPushUrlProperty",()=>c,"updateConversationWithMessage",()=>l],329801);let d=async(e,t)=>{let r=await fetch(`${a.BASE_API}/api/chat/generate-pdf/${e}`,{method:"POST",headers:{Authorization:`Bearer ${t}`}});if(!r.ok)throw Error("Failed to generate PDF");let n=await r.blob(),o=window.URL.createObjectURL(n),s=document.createElement("a");s.style.display="none",s.href=o,s.download=r.headers.get("Content-Disposition")?.split("filename=")[1]||"document.pdf",document.body.appendChild(s),s.click(),window.URL.revokeObjectURL(o)},p=async(e,t)=>{let r=await fetch(`${a.BASE_API}/api/chat/generate-docx/${e}`,{method:"POST",headers:{Authorization:`Bearer ${t}`}});if(!r.ok)throw Error("Failed to generate DOCX");let n=await r.blob(),o=window.URL.createObjectURL(n),s=document.createElement("a");s.style.display="none",s.href=o,s.download=r.headers.get("Content-Disposition")?.split("filename=")[1]||"document.docx",document.body.appendChild(s),s.click(),window.URL.revokeObjectURL(o)};e.s(["generateDocx",0,p,"generatePdf",0,d],15341)},915492,e=>{"use strict";var t=e.i(843476),r=e.i(271645);let a=(0,r.createContext)(void 0),n="isRightSidebarOpen";e.s(["SidebarsContextProvider",0,({children:e})=>{let[o,s]=(0,r.useState)(!0),[i,u]=(0,r.useState)(null),[l,c]=(0,r.useState)(()=>"true"===(()=>{try{let e=localStorage.getItem(n);if("true"===e||"false"===e)return e;return localStorage.setItem(n,"false"),"false"}catch(e){return"false"}})()),[d,p]=(0,r.useState)(!1),[m,h]=(0,r.useState)([]),[y,g]=(0,r.useState)(null),[w,f]=(0,r.useState)("variableExplorer"),[_,S]=(0,r.useState)(!1);(0,r.useEffect)(()=>{window.Cypress&&(window.appContext={analyses:m,setAnalyses:h})},[m]);let v=(0,r.useCallback)(e=>{c(e);try{localStorage.setItem(n,e?"true":"false")}catch(e){}},[]),b=async(e,t)=>{f("filePreview");let r=new TextDecoder,a=!1,n="";for(;!a;){let{value:o,done:s}=await e.read();if(a=s,o){let e=(n+=r.decode(o,{stream:!a})).split("\n");for(let r of(n=e.pop(),e))if(r){let e=JSON.parse(r);e&&h(r=>[...r.map(r=>r.id===t?{...r,results:{...r.results,...e}}:r)])}}}};return(0,t.jsx)(a.Provider,{value:{filename:i,setFilename:u,isRightSidebarOpen:l,setIsRightSidebarOpen:v,analyses:m,setAnalyses:h,handleReaderStream:b,hoveredIssueIndex:y,setHoveredIssueIndex:g,rightSidebarCurrentTab:w,setRightSidebarCurrentTab:f,isSplitscreen:_,setIsSplitscreen:S,isSidebarOpen:o,setIsSidebarOpen:s,isFullScreen:d,setIsFullScreen:p,handleToggleFullScreen:()=>{l||v(!0),p(e=>!e)}},children:e})},"useSidebarsContext",0,()=>(0,r.useContext)(a)])},367944,e=>{"use strict";var t=e.i(843476),r=e.i(271645),a=e.i(52563),n=e.i(912598),o=e.i(618566),s=e.i(604570),i=e.i(846696);e.i(971804);var u=e.i(511108),l=e.i(544216),c=e.i(602246),d=e.i(756563),p=e.i(562920),m=e.i(796610),h=e.i(38037),y=e.i(330973),g=e.i(329801),w=e.i(620949),f=e.i(15341),_=e.i(915492);let S=(0,r.createContext)(void 0);e.s(["ChatContextProvider",0,({children:e})=>{let[v,b]=(0,r.useState)(""),[A,C]=(0,r.useState)({}),{workflowId:$}=(0,o.useParams)(),E=(0,n.useQueryClient)(),[T,F]=(0,r.useState)(0),[k,j]=(0,r.useState)(!1),[O,I]=(0,r.useState)({}),[P,D]=(0,r.useState)(void 0),[Q,B]=(0,r.useState)(null),[U,z]=(0,r.useState)(null),[M,q]=(0,r.useState)([]),[R,x]=(0,r.useState)(null),[N,K]=(0,r.useState)(void 0),[L,G]=(0,r.useState)(!1),[J,W]=(0,r.useState)("default"),[V,H]=(0,r.useState)(!1),[Y,X]=(0,r.useState)(null),[Z,ee]=(0,r.useState)(""),[et,er]=(0,r.useState)(null),[ea,en]=(0,r.useState)("CPU"),[eo,es]=(0,r.useState)("Python3"),[ei,eu]=(0,r.useState)(null),[el,ec]=(0,r.useState)("auto"),[ed,ep]=(0,r.useState)(null),[em,eh]=(0,r.useState)({}),[ey,eg]=(0,r.useState)({}),ew=(0,r.useMemo)(()=>{let e=[],t=new Set;if(!ey)return e;try{for(let[r,a]of Object.entries(ey))for(let n of Array.isArray(a?.raw_schema)?a.raw_schema:[]){let a=(n?.schema_name??"").toString(),o=(n?.table_name??"").toString(),s=(n?.column_name??"").toString();if(!a||!o||!s)continue;let i=`${a}.${o}.${s}`,u=`${r}:${i}`;t.has(u)||(t.add(u),e.push({id:u,label:i}))}}catch(e){}return e},[ey]),[ef,e_]=(0,r.useState)({}),[eS,ev]=(0,r.useState)(!1),[eb,eA]=(0,r.useState)(!1),eC=(0,r.useRef)([]),[e$,eE]=(0,r.useState)("status message"),[eT,eF]=(0,r.useState)(null),[ek,ej]=(0,r.useState)(!1),[eO,eI]=(0,r.useState)(!1),[eP,eD]=(0,r.useState)(!1),[eQ,eB]=(0,r.useState)(!1),[eU,ez]=(0,r.useState)({}),[eM,eq]=(0,r.useState)(!1),[eR,ex]=(0,r.useState)(null),[eN,eK]=(0,r.useState)(null),[eL,eG]=(0,r.useState)([]),[eJ,eW]=(0,r.useState)(null),[eV,eH]=(0,r.useState)("main"),[eY,eX]=(0,r.useState)(null),[eZ,e0]=(0,r.useState)(null),[e1,e6]=(0,r.useState)(),[e3,e2]=(0,r.useState)(!1),[e5,e4]=(0,r.useState)(!1),[e9,e7]=(0,r.useState)([]),[e8,te]=(0,r.useState)(!1),[tt,tr]=(0,r.useState)(null),[ta,tn]=(0,r.useState)(null),[to,ts]=(0,r.useState)([]),[ti,tu]=(0,r.useState)(!1),[tl,tc]=(0,r.useState)(null),[td,tp]=(0,r.useState)(null),[tm,th]=(0,r.useState)(!1),[ty,tg]=(0,r.useState)(!1),[tw,tf]=(0,r.useState)(!1),[t_,tS]=(0,r.useState)(!1),[tv,tb]=(0,r.useState)(void 0),{user:tA}=(0,a.useAuth0)(),{data:tC}=(0,w.useUserInformation)(),t$=(0,o.useRouter)(),tE=(0,r.useRef)(void 0),tT=(0,o.useSearchParams)(),tF=(0,p.useShareConversationWithGroup)(),tk=(0,l.useEnableConnectionStream)(),{mutateAsync:tj}=(0,l.useDisableConnectionDynamic)(),{setIsRightSidebarOpen:tO,setRightSidebarCurrentTab:tI}=(0,_.useSidebarsContext)(),{data:tP}=(0,l.useUserConnections)(),{data:tD}=(0,d.useTeamDataConnections)(),tQ=(0,r.useMemo)(()=>{if(!O||!U)return[];if(U in O){let e=tt?.tool_display_mode;return(0,h.getMessageGroups)({messages:O[U]?.messages||[],options:{collapseAllCode:"collapse_code"===e}})}return[]},[O,U,e1,tt?.tool_display_mode]),tB=(0,r.useMemo)(()=>tQ?.filter(e=>"user"===e.role)?.length,[tQ]),{createConversation:tU,addSourceToConversation:tz,setPersonalization:tM,saveGraphEditsToMessage:tq,getMessagesByConversationId:tR,getConversationsById:tx,getConversations:tN,shareConversationWithTeam:tK}=(0,u.useChatAPI)(),tL=(0,r.useCallback)((e,t)=>(0,h.replaceOutputsAndImagesFromGlobalDicts)(e,t),[h.replaceOutputsAndImagesFromGlobalDicts]),tG=(0,r.useCallback)((e,t)=>(0,f.generatePdf)(e,t),[f.generatePdf]),tJ=(0,r.useCallback)((e,t)=>(0,f.generateDocx)(e,t),[f.generateDocx]),tW=(0,r.useCallback)(async({text:e,navigate:t,files:r,tempUserId:a,connection:n,juliusApp:o})=>{let s=await tU({provider:J,server_type:ea,tool_preferences:tt,conversation_plan:e1,julius_app:o}),u=s.id,l=[];if(r){let e={};for(let t of r){let r=await tz(u,t.name,a);"success"===r.status&&(l.push({name:t.name}),r.image_url&&eC.current.push({url:r.image_url,filename:r.filename})),e[t.name]=t}eh(e)}if(s.sources=l,n){let e=t3?.find(e=>e.id===n.type);if(!e)throw Error("Connector not found");let t=n?.name||`${e.name} Connection`;eh(r=>({...r,[t]:{name:t,type:"connection",ext:e.name,isUploading:!0,percentComplete:50,uploadMessage:"Connecting...",size:0}}));try{await tk.mutateAsync({connectionId:n.id,conversationId:u}),eh(e=>({...e,[t]:{...e[t],isUploading:!1,percentComplete:100}})),t5([n])}catch(e){throw eh(e=>{let r={...e};return delete r[t],r}),i.toast.error("Failed to enable data connection",{description:e instanceof Error?e.message:"Unknown error"}),e}}else if(tC?.preferences?.persist_data_connections_across_chats===void 0||tC?.preferences?.persist_data_connections_across_chats){let e=window.localStorage.getItem("persistedDataConnectionIds"),t=e?JSON.parse(e):[];if(Array.isArray(t)&&t.length>0)for(let e of[...tP||[],...tD||[]].filter(e=>t.includes(e.id)))t5([e])}I(e=>({...e,[u]:s})),z(u);let c=tT.get("teamId"),d=tT.get("action"),p=tT.get("groupId");if("team"===d&&c&&(p?await tF.mutateAsync({conversationId:u,teamId:c,groupId:p,share:!0}):await tK(u,c,!0)),!n){let t=e;l.length&&(t=(0,h.getTextWithUploadsMessage)(l,e)),eY&&(t=`${t}

I'm currently looking at a plot based on the above file and the following instructions: ${eY.plotInstructions}`),X(t)}return t?t$.push(`/chat?id=${u}`):(0,g.setAndPushUrlProperty)({property:"id",value:u}),s},[tz,em,e1,tU,eY,J,t$,ea,tt,ey]);(0,r.useEffect)(()=>{if(eT?.sheets){let e=Object.keys(eT?.sheets);eH(e.length>0?e[0]:"main")}else eH("main")},[eT?.sheets]),(0,r.useEffect)(()=>{tt?.longterm_planning||e2(!1)},[tt]);let{setAnalyses:tV}=(0,_.useSidebarsContext)(),{data:tH}=(0,w.useUserSubscription)();(0,r.useEffect)(()=>{if(tt?.disable_all||!tC?.preferences?.advanced_reasoning)return void tn(null);if(U&&O[U]){let e=O[U].messages||[],t=e?.slice().reverse().find(e=>"user"===e.role);t?.plan&&Array.isArray(t?.plan?.steps)&&t?.plan?.steps.length>0?tn(t.plan):tn(null)}else tn(null)},[U,O,tt,tC?.preferences?.advanced_reasoning]),(0,r.useEffect)(()=>{let e=!1;for(let t in em)em[t].isUploading&&(e=!0);eA(e)},[em]);let tY=O&&Object.keys(O).length,tX=(0,r.useCallback)(async({sourceId:e,currentConversationId:t,pathname:r=null,tempUserId:a=null})=>{let n;H(!0);let o=t;o?n=O[o]:(z(o=(n=await tU({provider:J,server_type:ea,tool_preferences:tt})).id),I(e=>({...e,[o]:n})),t$.push(r?`${r}?id=${o}`:`/chat?id=${o}`,void 0));let s=await tz(o,e,a);if("success"===s.status){let e=s?.sources;if(!n)return;n.sources=e,s.image_url&&eC.current.push({url:s.image_url,filename:s.filename}),I({...O,[o]:n})}return H(!1),s},[O,J,O]),tZ=(0,r.useCallback)((e,t,r)=>{let a=r.split("-function")[0],n=e[t]?.messages,o=n.findIndex(e=>e.id===a);o>-1&&(n.splice(o,1),I({...e}))},[]),t0=(0,r.useCallback)(()=>{eF(null),eH(null),e0(null),tV([]),eg({})},[tV]);(0,r.useEffect)(()=>{if($||!tT.get("id"))return;let e=async e=>{eu(!0),eE("Fetching new messages...");try{let t=await tR(e);if(Array.isArray(t)){for(let r of(rt(e,{messages:t}),t))if("function"===r.role)try{let e=JSON.parse(r.content);"object"==typeof e&&(e.outputs_dict&&Object.entries(e.outputs_dict).forEach(([e,t])=>{h.globalOutputsDict[e]=t}),e.image_urls_dict&&Object.entries(e.image_urls_dict).forEach(([e,t])=>{h.globalImageUrlsDict[e]=t}))}catch(e){console.error(e)}}}catch(e){x(e.toString())}finally{eu(!1)}},t=O[U];!(t&&Array.isArray(t.messages))&&U&&e(U)},[U,$,O,tR,t0,tT]);let t1=()=>O[U],t6=(0,r.useMemo)(()=>!!Array.isArray(O[U]?.messages)&&O[U]?.messages?.some(e=>{let t=new Date(e.completed_at);return(new Date().getTime()-t.getTime())/36e5<1}),[O[U]?.messages]),{data:t3}=(0,l.useConnectors)(),t2=async(e,t,r,a,n)=>{let o=void 0!==n?n:U;if(t)s.default.capture("data_connection_deselected",{connection_type:e.type}),U?i.toast.promise(t8(e.id),{loading:"Disabling data connection...",success:"Data connection disabled",error:"Failed to disable data connection"}):t7(e.id);else if(s.default.capture("data_connection_selected",{connection_type:e.type}),o){let t=t3?.find(t=>t.id===e.type);if(!t)return void i.toast.error("Connector not found");let r=e?.name||`${t.name} Connection`;eh(e=>({...e,[r]:{name:r,type:"connection",ext:t.name,isUploading:!0,percentComplete:50,uploadMessage:"Connecting...",size:0}}));try{await tk.mutateAsync({connectionId:e.id,conversationId:o}),eh(e=>({...e,[r]:{...e[r],isUploading:!1,percentComplete:100}})),t5(e),tO(!0),tI("variableExplorer")}catch(e){eh(e=>{let t={...e};return delete t[r],t}),i.toast.error("Failed to enable data connection",{description:e instanceof Error?e.message:"Unknown error"})}}else try{j(!0),await tW({connection:e}),j(!1),tO(!0),tI("variableExplorer")}catch(t){s.default.capture("chat:data_connection_add_failed",{error:t instanceof Error?t.message:"Unknown error",connection_type:e.type})}},t5=e=>{eg(t=>{let r={...t};return(Array.isArray(e)?e:[e]).forEach(e=>{let t=t3?.find(t=>t.id===e.type);r[e.id]={...e,db_type:t?.name}}),r})},t4=(0,r.useCallback)(async e=>{eh(t=>{let r={...t};return Array.isArray(e)?e.forEach(e=>{r[e.name]={name:e.name,isUploading:e.isUploading,imgPreviewSrc:e.imgPreviewSrc,size:e.size}}):r[e.name]={name:e.name,isUploading:e.isUploading,imgPreviewSrc:e.imgPreviewSrc,size:e.size},r})},[]),t9=(0,r.useCallback)(async()=>{let e={};if(!tA)return e;if(eu(!0),K(!0),tA)try{let t=await tN({page:1,per_page:20});if("metadata"in t&&D(t.metadata),"conversations"in t){e=t.conversations;try{let t=window.localStorage.getItem("pinnedConversations");if(t){let r=JSON.parse(t).filter(t=>!e[t]);if(r.length>0){let t=await tx({ids:r});e={...e,...t.conversations}}}}catch(e){console.error("Error handling pinned conversations:",e)}}Object.keys(e).length>0&&I(t=>{if("object"!=typeof e)return t;let r={...e};if("object"==typeof t)for(let a in t)if(a in e){let n=e[a],o=t[a].messages,s=n.messages,i={...n,messages:Array.isArray(o)&&o.length>0?o:s};r[a]=i}else r[a]=t[a];return r})}catch(e){i.toast.error("Oops. We've encountered an error fetching your conversations.",{description:"Please try again later."})}return eu(!1),K(!1),e},[tN,tA]),t7=e=>{eg(t=>{let r={...t};return delete r[e],r})},t8=async e=>{await tj({connectionId:e,conversationId:U}),t7(e)},re=async e=>{(eT?.filename===e||eT?.sheets?.main?.filename===e)&&t0(),eh(t=>{let r={...t};return delete r[e],r});let t=em[e];if(t?.type&&"file"!==t.type){let t=Object.values(ey).find(t=>t.name===e||`${t.db_type} Connection`===e);if(t)return void(U?i.toast.promise(t8(t.id),{loading:"Disabling data connection...",success:"Data connection disabled",error:"Failed to disable data connection"}):t7(t.id))}},rt=(e,t)=>{I(r=>{let a,n={...r||{}};return a=e in n&&"object"==typeof n[e]?n[e]:{id:e,messages:[]},{...n,[e]:{...a,...t}}})},rr=(0,r.useCallback)((e,t)=>{if(I(r=>{if(!(U in r))return r;let a={...r[U]};if(!a?.messages)return r;let n=a.messages.map(r=>r.message_id===e?{...r,isCollapsed:t}:r);return a.messages=n,{...r,[U]:a}}),$){let r=E.getQueryData((0,c.getWorkflowQueryKey)($));r?.conversation_id&&E.setQueryData(["conversation/messages",r.conversation_id],r=>Array.isArray(r)?r.map(r=>r.message_id===e?{...r,isCollapsed:t}:r):r)}},[U,$,E]),ra=(0,r.useRef)({}),rn=(0,r.useMemo)(()=>{let e=[];for(let[t,r]of Object.entries(eZ||{})){let a=r?.issues?.formatting_issues,n=r?.issues?.column_headers_on_row>-1&&r?.issues?.column_headers_on_row!==null,o=r?.issues?.empty_rows_indices?.length>0;n&&e.push({sheetName:t,issue:"headerIssues",details:r.issues.column_headers_on_row}),o&&e.push({sheetName:t,issue:"emptyRows",details:r.issues.empty_rows_indices}),a&&e.push({sheetName:t,issue:"formattingIssues",details:a})}return e},[eZ]),[ro,rs]=(0,r.useState)(!0);(0,r.useEffect)(()=>{window.Cypress&&(window.appContext={fileValidationInfo:eZ,setFileValidationInfo:e0})},[eZ]);let{data:ri}=(0,m.useCurrentTeam)(),ru=!tH?.status&&!ri?.paid,rl=(Object.keys(em).length>0||O[U]?.sources?.length>0)&&ru,[rc,rd]=(0,r.useState)(!1),rp=(0,r.useRef)("");return(0,t.jsx)(S.Provider,{value:{activeDataConnections:ef,setActiveDataConnections:e_,messageListHandle:tE,paginationMetadata:P,setPaginationMetadata:D,toggleMessageCollapse:rr,allSheetIssues:rn,showHelpButton:ro,setShowHelpButton:rs,creatingChat:k,setCreatingChat:j,tempUserId:et,setTempUserId:er,addingSource:V,conversations:O,setConversations:I,activeConversationId:U,setActiveConversationId:z,buttons:M,setButtons:q,error:R,setError:x,loadingConversations:N,setLoadingConversations:K,isGenerating:L,setIsGenerating:G,removeFunctionRunningMessage:tZ,getCurrentConversation:t1,fetchConversations:t9,updateConversation:rt,handleAddFileToChat:tX,modelProvider:J,setModelProvider:e=>{W(e)},selectedModels:to,setSelectedModels:ts,startingMessage:Y,setStartingMessage:X,input:Z,setInput:ee,getCurrentConversationPersonalization:()=>t1()?.personalization,setCurrentConversationPersonalization:e=>{let t={...O};t[U].personalization=e,I(t),tM(U,e)},serverType:ea,setServerType:en,loadingChat:ei,setLoadingChat:eu,chatMode:el,setChatMode:ec,generatingStatusMessage:ed,setGeneratingStatusMessage:ep,attachments:em,setAttachments:eh,handleAddAttachments:t4,dataConnections:ey,dataConnectionMentions:ew,handleRemoveDataConnection:t7,handleSelectDataConnection:t2,handleAddDataConnections:t5,handleRemoveAttachment:re,updateAttachmentUploadStatus:({originalFilename:e,updatedFilename:t,isUploading:r})=>{t?eh(a=>{let n={...a};return n[e]&&(delete n[e],n[t]={name:t,isUploading:r,imgPreviewSrc:a[e]?.imgPreviewSrc,size:a[e]?.size}),n}):eh(t=>{let a={...t};return a[e]&&(a[e]={...a[e],name:e,isUploading:r,imgPreviewSrc:t[e]?.imgPreviewSrc,size:t[e]?.size}),a})},updateAttachmentUploadProgress:(e,t,r)=>{-1===t&&-1===t?eh(t=>{let r={...t};return delete r[e],r}):eh(a=>({...a,[e]:{...a[e],name:e,isUploading:!0,percentComplete:t,...void 0!==r&&{size:r}}}))},setAttachmentUploadingToDone:(e,t)=>{eh(r=>{let a={...r},n=t||e;return a[n]?a[n]={...a[n],name:n,isUploading:!1}:e!==t&&a[e]?(a[t]={...a[e],name:t,isUploading:!1},delete a[e]):a[n]={name:e,isUploading:!1},a})},kernelName:eo,setKernelName:es,isOwner:eS,setIsOwner:ev,conversationsLoaded:tY,currentUploadedImagesRef:eC,getNewImageUrls:()=>eC?.current?.filter(e=>O?.[U]?.sources?O[U]?.sources.find(t=>t.name===e.filename):[])||[],isWorking:eb,setIsWorking:eA,backendStatusMessage:e$,setBackendStatusMessage:eE,addFakeMessage:e=>{let t={...O},r=t[U];r?.messages?.push(e),I(t)},hasNewMessages:t6,editMessageImage:({imageCode:e,imageURL:t,assistantMessageId:r})=>{let a=O[U];if(!Array.isArray(a?.messages))return;let n=a.messages.findIndex(e=>e.message_id===r),o=a.messages[n],s=null;if(o)try{let t=o.function_call?.arguments;if(t){let r=JSON.parse(t),a=Object.keys(r)[0];r[a].includes("#START OF EDITED GRAPH")&&(r[a]=r[a].slice(0,r[a].indexOf("#START OF EDITED GRAPH"))),r[a]+="\n"+e,s=r,o.function_call.arguments=JSON.stringify(r),I({...O})}}catch(e){}let i=a.messages[n+1],u=null;if(i){let e=JSON.parse(i.content);u=Object.keys(e?.image_urls_dict)[0],e.image_urls_dict={[u]:t},i.content=JSON.stringify(e),I({...O})}i&&o&&tq({codeMessageId:o.message_id,imageMessageId:i.message_id,imageURL:t,finalMessageArgs:s,imageKey:u})},dataframeProps:eT,setDataframeProps:eF,resetChat:(e=null)=>{z(e),t0(),eh({}),e6(void 0),e2(!1),(0,y.handleCloseConnection)(),G(!1),e0(null),tV([]),eK(null),eG([]),eX(null),tp(null),tc(null),th(!1),tg(!1),tS(!1),B(null),ra.current={}},editingDataframe:ek,setEditingDataframe:ej,validatingDataframe:eO,setValidatingDataframe:eI,fixingDataframe:eP,setFixingDataframe:eD,freeAndHasAttachmentsOrSources:rl,exportingDataframe:eQ,setExportingDataframe:eB,sheets:eJ,setSheets:eW,currentSheet:eV,setCurrentSheet:eH,currentQuickPlotsState:eY,setCurrentQuickPlotsState:eX,fileValidationInfo:eZ,setFileValidationInfo:e0,toolPreferences:tt,setToolPreferences:tr,resetPreviewAndAttachments:()=>{t0(),eh({})},lastMessagePlan:ta,setLastMessagePlan:tn,conversationPlan:e1,setConversationPlan:e6,startConversation:tW,isAutoPlay:e3,setIsAutoPlay:e2,dataframePreviewMetadata:eU,setDataframePreviewMetadata:ez,dataframeColumnSummary:eN,setDataframeColumnSummary:eK,dataframeSuggestions:eL,setDataframeSuggestions:eG,dataframePreviewChanged:e8,setDataframePreviewChanged:te,isEvaluatingSteps:e5,setIsEvaluatingSteps:e4,filteredConversations:e9,setFilteredConversations:e7,totalConversationsCount:T,setTotalConversationsCount:F,useInteractive:ti,setUseInteractive:tu,isFreeUser:ru,passedSharedWorkflowId:td,setPassedSharedWorkflowId:tp,passedWorkflowId:tl,setPassedWorkflowId:tc,userMessageCount:tB,activeConversationMessageGroups:tQ,showRating:tm,setShowRating:th,modal:v,setModal:b,modalProps:A,setModalProps:C,showFeedback:ty,setShowFeedback:tg,showSlackCTA:tw,setShowSlackCTA:tf,showTryAdvancedReasoning:t_,setShowTryAdvancedReasoning:tS,setQueueAutoPlay:tb,queueAutoPlay:tv,isKeyboardWhileRunningWorkflowToggled:eM,setIsKeyboardWhileRunningWorkflowToggled:eq,memoizedReplaceOutputsAndImagesFromGlobalDicts:tL,memoizedGenerateDocx:tJ,memoizedGeneratePdf:tG,activePlanStepId:Q,setActivePlanStepId:B,showUpgradeBanner:rc,setShowUpgradeBanner:rd,pageStateTracker:ra,newChatPromptRef:rp,setDataConnections:eg,dataLocationSelection:eR,setDataLocationSelection:ex},children:e})},"useChatContext",0,()=>(0,r.useContext)(S)])},933818,e=>{"use strict";function t(e){return e}e.s(["queryOptions",()=>t])},213248,e=>{"use strict";async function t(e,t){let r,a=e.getReader();for(;!(r=await a.read()).done;)t(r.value)}function r(){return{data:"",event:"",id:"",retry:void 0}}var a=function(e,t){var r={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&0>t.indexOf(a)&&(r[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,a=Object.getOwnPropertySymbols(e);n<a.length;n++)0>t.indexOf(a[n])&&Object.prototype.propertyIsEnumerable.call(e,a[n])&&(r[a[n]]=e[a[n]]);return r};let n="text/event-stream",o="last-event-id";function s(e){let t=e.headers.get("content-type");if(!(null==t?void 0:t.startsWith(n)))throw Error(`Expected content-type to be ${n}, Actual: ${t}`)}var i=e.i(394073),u=e.i(647163);let l=`${i.BASE_API}/api/data_connectors`,c=async({accessToken:e})=>{let t=await (0,u.customFetch)(`${l}/`,{headers:{Authorization:`Bearer ${e}`},method:"GET"});if(!t.ok)throw Error("Failed to fetch data connectors");let r=await t.json();return r.connectors||r},d=async({accessToken:e,connectorId:t})=>{let r=await (0,u.customFetch)(`${l}/connector/${t}`,{headers:{Authorization:`Bearer ${e}`}});if(!r.ok)throw Error("Failed to fetch data connector");return await r.json()},p=async({accessToken:e})=>{let t=await (0,u.customFetch)(`${l}/user_connections`,{headers:{Authorization:`Bearer ${e}`}});if(!t.ok)throw Error("Failed to fetch user connections");return await t.json()},m=async({accessToken:e,connectionId:t})=>{let r=await (0,u.customFetch)(`${l}/get_schema_for_sql_editor`,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},method:"POST",body:JSON.stringify({connection_id:t})});if(!r.ok)throw Error("Failed to fetch schema for SQL editor");return await r.json()};async function h(e,t){let r=t.public_key.replace("-----BEGIN PUBLIC KEY-----","").replace("-----END PUBLIC KEY-----","").replace(/\s/g,"");try{let t=window.atob(r),a=function(e){let t=new ArrayBuffer(e.length),r=new Uint8Array(t);for(let t=0,a=e.length;t<a;t++)r[t]=e.charCodeAt(t);return t}(t),n=await window.crypto.subtle.importKey("spki",a,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt","wrapKey"]),o=new TextEncoder().encode(JSON.stringify(e)),s=await window.crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt","wrapKey"]),i=window.crypto.getRandomValues(new Uint8Array(12)),u=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:i},s,o),l=await window.crypto.subtle.wrapKey("raw",s,n,"RSA-OAEP");return{encrypted_data:window.btoa(String.fromCharCode(...new Uint8Array(u))),encrypted_key:window.btoa(String.fromCharCode(...new Uint8Array(l))),iv:window.btoa(String.fromCharCode(...new Uint8Array(i)))}}catch{throw Error("Failed to encrypt connection info")}}let y=async({accessToken:e,connectorId:t,connectionInfo:r,connectionName:a,publicKey:n})=>{try{let o=await h(r,n),s=await (0,u.customFetch)(`${l}/create_connection`,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},method:"POST",body:JSON.stringify({connector_id:t,connection_info:o,name:a})});if(!s.ok){let e;try{e=await s.json()}catch{throw Error("Failed to create connection")}throw Error(e?.message||e?.error||"Failed to create connection")}return await s.json()}catch(e){throw console.error("Error creating connection:",e),e}},g=async({accessToken:e,connectionId:i,conversationId:u,signal:c,onMessage:d,waitForSchema:p})=>{await function(e,i){var{signal:u,headers:l,onopen:c,onmessage:d,onclose:p,onerror:m,openWhenHidden:h,fetch:y}=i,g=a(i,["signal","headers","onopen","onmessage","onclose","onerror","openWhenHidden","fetch"]);return new Promise((a,i)=>{let w,f=Object.assign({},l);function _(){w.abort(),document.hidden||$()}f.accept||(f.accept=n),h||document.addEventListener("visibilitychange",_);let S=1e3,v=0;function b(){document.removeEventListener("visibilitychange",_),window.clearTimeout(v),w.abort()}null==u||u.addEventListener("abort",()=>{b(),a()});let A=null!=y?y:window.fetch,C=null!=c?c:s;async function $(){var n,s,u,l;w=new AbortController;try{let n,i,c,m,h,y,_=await A(e,Object.assign(Object.assign({},g),{headers:f,signal:w.signal}));await C(_),await t(_.body,(s=e=>{e?f[o]=e:delete f[o]},u=e=>{S=e},n=r(),i=new TextDecoder,l=function(e,t){if(0===e.length)null==d||d(n),n=r();else if(t>0){let r=i.decode(e.subarray(0,t)),a=t+(32===e[t+1]?2:1),o=i.decode(e.subarray(a));switch(r){case"data":n.data=n.data?n.data+"\n"+o:o;break;case"event":n.event=o;break;case"id":s(n.id=o);break;case"retry":let l=parseInt(o,10);isNaN(l)||u(n.retry=l)}}},y=!1,function(e){var t,r;let a;void 0===c?(c=e,m=0,h=-1):(t=c,r=e,(a=new Uint8Array(t.length+r.length)).set(t),a.set(r,t.length),c=a);let n=c.length,o=0;for(;m<n;){y&&(10===c[m]&&(o=++m),y=!1);let e=-1;for(;m<n&&-1===e;++m)switch(c[m]){case 58:-1===h&&(h=m-o);break;case 13:y=!0;case 10:e=m}if(-1===e)break;l(c.subarray(o,e),h),o=m,h=-1}o===n?c=void 0:0!==o&&(c=c.subarray(o),m-=o)})),null==p||p(),b(),a()}catch(e){if(!w.signal.aborted)try{let t=null!=(n=null==m?void 0:m(e))?n:S;window.clearTimeout(v),v=window.setTimeout($,t)}catch(e){b(),i(e)}}}$()})}(`${l}/connection/${i}/conversation/${u}/streaming_enable`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({wait_for_schema:p}),signal:c,onmessage(e){let t=JSON.parse(e.data);if(d?.(t),t?.type==="connection"&&"error"===t.status)throw Error(t.message?.trim()||t.raw_message?.trim()||"Failed to enable connector")},onerror(e){throw e}})},w=async({accessToken:e})=>{let t=await (0,u.customFetch)(`${l}/public_key`,{method:"GET",headers:{Authorization:`Bearer ${e}`}});if(!t.ok)throw Error("Failed to get public key");return await t.json()},f=async({accessToken:e,connectionId:t})=>{if(!(await (0,u.customFetch)(`${l}/connection/${t}`,{headers:{Authorization:`Bearer ${e}`},method:"DELETE"})).ok)throw Error("Failed to delete connection")},_=async({accessToken:e,connectionId:t,conversationId:r})=>{if(!(await (0,u.customFetch)(`${l}/connection/${t}/conversation/${r}/disable`,{headers:{Authorization:`Bearer ${e}`},method:"POST"})).ok)throw Error("Failed to disable connection");return!0},S=async({accessToken:e,connectionId:t,connectionName:r,connectionInfo:a,publicKey:n,abortSignal:o=null})=>{let s=await h(a,n),i=await (0,u.customFetch)(`${l}/connection/${t}/update`,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},method:"PUT",body:JSON.stringify({name:r,connection_info:s}),signal:o});if(!i.ok){let e;try{e=await i.json()}catch{throw Error("Failed to update connection")}throw Error(e?.message||e?.error||"Failed to update connection")}return await i.json()},v=async({accessToken:e,connectionId:t,connectionName:r})=>{let a=await (0,u.customFetch)(`${l}/connection/${t}/update`,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},method:"PUT",body:JSON.stringify({name:r})});if(!a.ok)throw Error("Failed to update connection");return await a.json()},b=async({accessToken:e,connectionId:t,customInstructions:r})=>{if(!(await (0,u.customFetch)(`${l}/set_connection_custom_instructions`,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},method:"POST",body:JSON.stringify({connection_id:t,custom_instructions:r})})).ok)throw Error("Failed to update connection custom instructions")},A=async({activeConversationId:e,connectionId:t,getAccessTokenSilently:r,prompt:a,currentWindow:n,signal:o,transientConversation:s})=>{let i=await r(),c={"Content-Type":"application/json",Authorization:`Bearer ${i}`,"Openai-Ephemeral-User-Id":"test-user"};e&&(c["Conversation-Id"]=String(e));let d={conversation_id:e??null,connection_id:t??null,current_window:n??null,transient_conversation:s??!1},p=a?.trim();p&&(d.prompt=p);let m=await (0,u.customFetch)(`${l}/construct`,{method:"POST",headers:c,body:JSON.stringify(d),signal:o}),h=await m.json();if(!m.ok)throw Error(("string"==typeof h?.detail&&h.detail.trim()?h.detail.trim():null)||("string"==typeof h?.message&&h.message.trim()?h.message.trim():"Failed to construct helper query."));return h},C=async({getAccessTokenSilently:e})=>{let t=await e(),r=await (0,u.customFetch)(`${l}/static_ip`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}});if(!r.ok)throw Error("Failed to get static IP");return await r.json()},$=async({accessToken:e,connectionId:t})=>{let r=await (0,u.customFetch)(`${l}/connection/${t}/filtered_schema`,{method:"GET",headers:{Authorization:`Bearer ${e}`}});if(!r.ok){let e=await r.json().catch(()=>void 0);throw Error(e?.message||"Failed to fetch schema")}return await r.json()},E=async({accessToken:e,connectionId:t})=>{let r=await (0,u.customFetch)(`${l}/connection/${t}/browse_schema`,{method:"GET",headers:{Authorization:`Bearer ${e}`}});if(!r.ok){let e=await r.json().catch(()=>void 0);throw Error(e?.message||"Failed to fetch browse schema")}return await r.json()},T=async({accessToken:e,connectionId:t,filteredSchema:r})=>{let a=await (0,u.customFetch)(`${l}/connection/${t}/filtered_schema`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({filtered_schema:r})});if(!a.ok){let e=await a.json().catch(()=>void 0);throw Error(e?.message||"Failed to update filtered schema")}},F=async({accessToken:e,connectionId:t,setFreeze:r})=>{if(!(await (0,u.customFetch)(`${l}/freeze_learning`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({mcp_id:t,set_freeze:r})})).ok)throw Error("Failed to update learning freeze state")},k=async({accessToken:e,connectionId:t,learningData:r})=>{if(!(await (0,u.customFetch)(`${l}/update_learning`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({mcp_id:t,learning_data:r})})).ok)throw Error("Failed to update learning data")},j=async({accessToken:e,connectionId:t,learningData:r})=>{let a=await (0,u.customFetch)(`${l}/get_learning`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({mcp_id:t,learning_data:r})});if(!a.ok)throw Error("Failed to fetch learning data");return await a.json()},O=async({accessToken:e,learningId:t})=>{if(!(await (0,u.customFetch)(`${l}/restore_learning`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({learning_id:t})})).ok)throw Error("Failed to restore learning")},I=async({accessToken:e,learningId:t})=>{if(!(await (0,u.customFetch)(`${l}/delete_learning`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({learning_id:t})})).ok)throw Error("Failed to delete learning")},P=async({accessToken:e,connectionId:t,conversationId:r,params:a})=>{let n=await (0,u.customFetch)(`${l}/${t}/query`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({conversation_id:r,params:a})});if(!n.ok)throw await n.json();return n.json()},D=async({accessToken:e})=>{let t=await (0,u.customFetch)(`${i.BASE_API}/api/mcp_store/entries`,{method:"GET",headers:{Authorization:`Bearer ${e}`}});if(!t.ok)throw Error("Failed to fetch MCP store entries");let r=await t.json();return r.entries||r},Q=async({accessToken:e})=>{let t=await (0,u.customFetch)(`${i.BASE_API}/api/mcp_store/entries/all`,{method:"GET",headers:{Authorization:`Bearer ${e}`}});if(!t.ok)throw Error("Failed to fetch MCP store entries (all)");let r=await t.json();return r.entries||r},B=async({accessToken:e})=>{let t=await (0,u.customFetch)(`${l}/get_ssh_credential`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}});if(!t.ok)throw Error("Failed to fetch ssh credential");return await t.json()},U=async({accessToken:e,connectionId:t,dataDictionaryRawText:r})=>{if(!(await (0,u.customFetch)(`${l}/connection/${t}/update_data_dictionary`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({data_dictionary_raw_text:r})})).ok)throw Error("Failed to update data dictionary raw text")},z=async({accessToken:e,schemaIds:t,hidden:r})=>{let a=await (0,u.customFetch)(`${l}/schema/batch_toggle_visibility`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({schema_ids:t,hidden:r})});if(!a.ok)throw Error("Failed to batch toggle visibility");return await a.json()},M=async({accessToken:e,schemaId:t,frozen:r})=>{let a=await (0,u.customFetch)(`${l}/schema/${t}/toggle_frozen`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({frozen:r})});if(!a.ok)throw Error("Failed to toggle frozen state");return await a.json()},q=async({accessToken:e,schemaId:t,connectionId:r,text:a})=>{let n=await (0,u.customFetch)(`${l}/add_learning`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({schema_id:t,text:a,connection_id:r})});if(!n.ok)throw Error("Failed to create learning");return await n.json()},R=async({accessToken:e,connectionId:t})=>{let r=await (0,u.customFetch)(`${l}/connection/${t}/review_learnings`,{headers:{Authorization:`Bearer ${e}`}});if(!r.ok)throw Error("Failed to fetch review learnings");return await r.json()},x=async({accessToken:e,learningId:t})=>{let r=await (0,u.customFetch)(`${l}/learning/${t}/approve`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!r.ok)throw Error("Failed to approve learning");return await r.json()},N=async({accessToken:e,learningId:t})=>{let r=await (0,u.customFetch)(`${l}/learning/${t}/reject`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!r.ok)throw Error("Failed to reject learning");return await r.json()},K=async({accessToken:e,learningId:t})=>{let r=await (0,u.customFetch)(`${l}/learning/${t}/revert`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!r.ok)throw Error("Failed to revert learning");return await r.json()},L=async({accessToken:e,learningIds:t})=>{let r=await (0,u.customFetch)(`${l}/learnings/batch/approve`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({learning_ids:t})});if(!r.ok)throw Error("Failed to batch approve learnings");return await r.json()},G=async({accessToken:e,learningIds:t})=>{let r=await (0,u.customFetch)(`${l}/learnings/batch/reject`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({learning_ids:t})});if(!r.ok)throw Error("Failed to batch reject learnings");return await r.json()},J=async({accessToken:e,learningIds:t})=>{let r=await (0,u.customFetch)(`${l}/learnings/batch/revert`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({learning_ids:t})});if(!r.ok)throw Error("Failed to batch revert learnings");return await r.json()},W=async({accessToken:e,connectionId:t})=>{let r=await (0,u.customFetch)(`${l}/connection/${t}/reviewed_learnings`,{headers:{Authorization:`Bearer ${e}`}});if(!r.ok)throw Error("Failed to fetch reviewed learnings");return await r.json()},V=async({accessToken:e,connectionId:t})=>{let r=await (0,u.customFetch)(`${l}/connection/${t}/autoapproval`,{headers:{Authorization:`Bearer ${e}`}});if(!r.ok)throw Error("Failed to get autoapproval mode");return await r.json()},H=async({accessToken:e,connectionId:t,autoapprovalEnabled:r})=>{let a=await (0,u.customFetch)(`${l}/connection/${t}/autoapproval`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({autoapproval_enabled:r})});if(!a.ok)throw Error("Failed to set autoapproval mode");return await a.json()};e.s(["approveLearning",0,x,"batchApproveLearnings",0,L,"batchRejectLearnings",0,G,"batchRevertLearnings",0,J,"batchToggleSchemaVisibility",0,z,"constructDataExplorerQuery",0,A,"createConnection",0,y,"createLearning",0,q,"deleteConnection",0,f,"deleteLearning",0,I,"disableConnection",0,_,"freezeLearning",0,F,"getAutoapprovalMode",0,V,"getBrowseSchema",0,E,"getConnectionSchemaWithFilter",0,$,"getConnector",0,d,"getConnectors",0,c,"getLearning",0,j,"getMcpStoreEntries",0,D,"getMcpStoreEntriesAll",0,Q,"getPublicKey",0,w,"getReviewLearnings",0,R,"getReviewedLearnings",0,W,"getSchemaForSqlEditor",0,m,"getSshCredential",0,B,"getStaticIp",0,C,"getUserConnections",0,p,"listConnectionData",0,P,"rejectLearning",0,N,"restoreLearning",0,O,"revertLearningToPending",0,K,"setAutoapprovalMode",0,H,"streamingEnableConnection",0,g,"toggleSchemaFrozen",0,M,"updateConnection",0,S,"updateConnectionCustomInstructions",0,b,"updateConnectionFilteredSchema",0,T,"updateConnectionName",0,v,"updateDataDictionaryRawText",0,U,"updateLearning",0,k],213248)},544216,e=>{"use strict";var t=e.i(52563),r=e.i(933818),a=e.i(954616),n=e.i(266027),o=e.i(912598),s=e.i(592747),i=e.i(213248);let u=new s.EventEmitter,l=()=>["data_connectors/user_connections"],c=e=>["data_connectors/learning",e],d=(e,t)=>["data_connectors/connection_data",e,t],p=e=>["data_connectors/autoapproval",e];e.s(["dataConnectionEventEmitter",0,u,"getLearningQueryKey",0,c,"getUserConnectionsQueryKey",0,l,"queryConnectionDataOptions",0,({connectionId:e,conversationId:t,accessToken:a,params:n})=>(0,r.queryOptions)({queryKey:d(e,n),queryFn:async()=>await (0,i.listConnectionData)({accessToken:a,connectionId:e,conversationId:t,params:n})}),"queryConnectionDataQueryKey",0,d,"useConnector",0,({connectorId:e})=>{let{getAccessTokenSilently:r}=(0,t.useAuth0)();return(0,n.useQuery)({queryKey:["data_connectors/connector",e],queryFn:async()=>{let t=await r();return(0,i.getConnector)({accessToken:t,connectorId:e})},staleTime:1/0,refetchOnWindowFocus:!1})},"useConnectors",0,()=>{let{getAccessTokenSilently:e}=(0,t.useAuth0)();return(0,n.useQuery)({queryKey:["data_connectors"],queryFn:async()=>{let t=await e();return(0,i.getConnectors)({accessToken:t})},staleTime:1/0,refetchOnWindowFocus:!1})},"useCreateConnection",0,({connectorId:e,publicKey:r})=>{let n=(0,o.useQueryClient)(),{getAccessTokenSilently:s}=(0,t.useAuth0)();return(0,a.useMutation)({mutationFn:async({connectionInfo:t,connectionName:a})=>{let n=await s();return(0,i.createConnection)({accessToken:n,connectorId:e,connectionInfo:t,connectionName:a,publicKey:r})},onSuccess:()=>{n.invalidateQueries({queryKey:l()})}})},"useDeleteConnection",0,()=>{let{getAccessTokenSilently:e}=(0,t.useAuth0)(),r=(0,o.useQueryClient)();return(0,a.useMutation)({mutationFn:async({connectionId:t})=>{let r=await e();await (0,i.deleteConnection)({accessToken:r,connectionId:t})},onSuccess:()=>{r.invalidateQueries({queryKey:l()}),r.invalidateQueries({queryKey:["google-ads-connected-accounts"]})}})},"useDisableConnectionDynamic",0,()=>{let{getAccessTokenSilently:e}=(0,t.useAuth0)();return(0,a.useMutation)({mutationFn:async({connectionId:t,conversationId:r})=>{let a=await e();return(0,i.disableConnection)({accessToken:a,connectionId:t,conversationId:r})}})},"useEnableConnectionStream",0,()=>{let{getAccessTokenSilently:e}=(0,t.useAuth0)();return(0,a.useMutation)({mutationFn:async({connectionId:t,conversationId:r="background_tasks",onMessage:a,waitForSchema:n=!0})=>{let o=await e();await (0,i.streamingEnableConnection)({accessToken:o,connectionId:t,conversationId:r,onMessage:a,waitForSchema:n})}})},"useFreezeLearning",0,()=>{let{getAccessTokenSilently:e}=(0,t.useAuth0)(),r=(0,o.useQueryClient)();return(0,a.useMutation)({mutationFn:async({connectionId:t,setFreeze:r})=>{let a=await e();await (0,i.freezeLearning)({accessToken:a,connectionId:t,setFreeze:r})},onSuccess:(e,{queryKey:t})=>{r.invalidateQueries({queryKey:t}),"team_data_connections/learning"===t[0]&&t[1]?r.invalidateQueries({queryKey:["team_data_connections",t[1]]}):r.invalidateQueries({queryKey:l()})}})},"useGetAutoapprovalMode",0,({connectionId:e,enabled:r=!0})=>{let{getAccessTokenSilently:a}=(0,t.useAuth0)();return(0,n.useQuery)({queryKey:p(e),queryFn:async()=>{let t=await a();return await (0,i.getAutoapprovalMode)({accessToken:t,connectionId:e})},enabled:!!e&&r,staleTime:1/0,refetchOnWindowFocus:!1})},"useGetLearning",0,({connectionId:e,enabled:r=!0})=>{let{getAccessTokenSilently:a}=(0,t.useAuth0)();return(0,n.useQuery)({queryKey:c(e),queryFn:async()=>{let t=await a();return await (0,i.getLearning)({accessToken:t,connectionId:e,learningData:{}})},enabled:!!e&&r,staleTime:1/0,refetchOnWindowFocus:!1,retry:!1})},"useGetStaticIp",0,()=>{let{getAccessTokenSilently:e}=(0,t.useAuth0)();return(0,n.useQuery)({queryKey:["data_connectors/static_ip"],queryFn:async()=>await (0,i.getStaticIp)({getAccessTokenSilently:e})})},"useMcpStoreEntries",0,()=>{let{getAccessTokenSilently:e}=(0,t.useAuth0)();return(0,n.useQuery)({queryKey:["mcp_store_entries"],queryFn:async()=>{let t=await e();return(0,i.getMcpStoreEntries)({accessToken:t})},staleTime:1/0,refetchOnWindowFocus:!1})},"useMcpStoreEntriesAll",0,()=>{let{getAccessTokenSilently:e}=(0,t.useAuth0)();return(0,n.useQuery)({queryKey:["mcp_store_entries_all"],queryFn:async()=>{let t=await e();return(0,i.getMcpStoreEntriesAll)({accessToken:t})},staleTime:1/0,refetchOnWindowFocus:!1})},"usePublicKey",0,()=>{let{getAccessTokenSilently:e}=(0,t.useAuth0)();return(0,n.useQuery)({queryKey:["data_connectors/public_key"],queryFn:async()=>{let t=await e();return(0,i.getPublicKey)({accessToken:t})},staleTime:1/0,refetchOnWindowFocus:!1})},"useQueryConnectionData",0,(e,r=!1)=>{let{getAccessTokenSilently:a}=(0,t.useAuth0)();return(0,n.useQuery)({queryKey:d(e.connectionId,e.params),queryFn:async()=>{let t=await a();return await (0,i.listConnectionData)({accessToken:t,...e})},retry:!1,enabled:r})},"useSetAutoapprovalMode",0,()=>{let{getAccessTokenSilently:e}=(0,t.useAuth0)(),r=(0,o.useQueryClient)();return(0,a.useMutation)({mutationFn:async({connectionId:t,autoapprovalEnabled:r})=>{let a=await e();return await (0,i.setAutoapprovalMode)({accessToken:a,connectionId:t,autoapprovalEnabled:r})},onMutate:async({connectionId:e,autoapprovalEnabled:t})=>{await r.cancelQueries({queryKey:p(e)});let a=r.getQueryData(p(e));return r.setQueryData(p(e),{autoapproval_enabled:t}),{previousValue:a}},onError:(e,{connectionId:t},a)=>{a?.previousValue&&r.setQueryData(p(t),a.previousValue)},onSettled:(e,t,{connectionId:a})=>{r.invalidateQueries({queryKey:p(a)})}})},"useSshCredential",0,()=>{let{getAccessTokenSilently:e}=(0,t.useAuth0)();return(0,n.useQuery)({queryKey:["data_connectors/ssh_credential"],queryFn:async()=>{let t=await e();return(0,i.getSshCredential)({accessToken:t})}})},"useUpdateConnection",0,()=>{let{getAccessTokenSilently:e}=(0,t.useAuth0)(),r=(0,o.useQueryClient)();return(0,a.useMutation)({mutationFn:async({connectionId:t,connectionName:a,connectionInfo:n,publicKey:o,abortSignal:s})=>{let u=await e(),c=await (0,i.updateConnection)({accessToken:u,connectionId:t,connectionName:a,connectionInfo:n,publicKey:o,abortSignal:s});return r.invalidateQueries({queryKey:l()}),c}})},"useUpdateConnectionCustomInstructions",0,()=>{let{getAccessTokenSilently:e}=(0,t.useAuth0)();return(0,a.useMutation)({mutationFn:async({connectionId:t,customInstructions:r})=>{let a=await e();await (0,i.updateConnectionCustomInstructions)({accessToken:a,connectionId:t,customInstructions:r})}})},"useUpdateConnectionName",0,()=>{let{getAccessTokenSilently:e}=(0,t.useAuth0)(),r=(0,o.useQueryClient)();return(0,a.useMutation)({mutationFn:async({connectionId:t,connectionName:a})=>{let n=await e(),o=await (0,i.updateConnectionName)({accessToken:n,connectionId:t,connectionName:a});return r.invalidateQueries({queryKey:l()}),o}})},"useUpdateLearning",0,()=>{let{getAccessTokenSilently:e}=(0,t.useAuth0)(),r=(0,o.useQueryClient)();return(0,a.useMutation)({mutationFn:async({connectionId:t,learningData:r})=>{let a=await e();await (0,i.updateLearning)({accessToken:a,connectionId:t,learningData:r})},onSuccess:(e,{queryKey:t})=>{r.invalidateQueries({queryKey:t})}})},"useUserConnection",0,()=>{let{getAccessTokenSilently:e}=(0,t.useAuth0)();return(0,n.useQuery)({queryKey:["data_connectors/user_connection"],queryFn:async()=>{let t=await e();return(0,i.getUserConnections)({accessToken:t})},staleTime:1/0,refetchOnWindowFocus:!1})},"useUserConnections",0,()=>{let{getAccessTokenSilently:e}=(0,t.useAuth0)();return(0,n.useQuery)({queryKey:["data_connectors/user_connections"],queryFn:async()=>{let t=await e();return(0,i.getUserConnections)({accessToken:t})},staleTime:1/0,refetchOnWindowFocus:!1})}])},756563,e=>{"use strict";var t=e.i(52563),r=e.i(954616),a=e.i(266027),n=e.i(912598),o=e.i(394073),s=e.i(647163);let i=async({teamId:e,accessToken:t})=>{let r=await (0,s.customFetch)(`${o.BASE_API}/teams/${e}/data-connections`,{headers:{Authorization:`Bearer ${t}`}});if(!r.ok)throw await r.json();return r.json()},u=async({teamId:e,connectionId:t,accessToken:r})=>{let a=await (0,s.customFetch)(`${o.BASE_API}/teams/${e}/data-connections/${t}`,{headers:{Authorization:`Bearer ${r}`},method:"POST"});if(!a.ok)throw await a.json();return a.json()},l=async({teamId:e,connectionId:t,accessToken:r})=>{let a=await (0,s.customFetch)(`${o.BASE_API}/teams/${e}/data-connections/${t}`,{headers:{Authorization:`Bearer ${r}`},method:"DELETE"});if(!a.ok)throw await a.json();return a.json()},c=async({teamId:e,connectionId:t,accessToken:r})=>{let a=await (0,s.customFetch)(`${o.BASE_API}/teams/${e}/data-connections/get_learning/${t}`,{headers:{Authorization:`Bearer ${r}`},method:"GET"});if(!a.ok)throw console.warn("Failed to fetch team connection learning data"),await a.json();return a.json()};var d=e.i(796610);let p=(e,t)=>["team_data_connections/learning",e,t];e.s(["getTeamConnectionLearningQueryKey",0,p,"useGetTeamConnectionLearning",0,({teamId:e,connectionId:r,enabled:n=!0})=>{let{getAccessTokenSilently:o}=(0,t.useAuth0)();return(0,a.useQuery)({queryKey:p(e,r),queryFn:async()=>{let t=await o();return await c({accessToken:t,teamId:e,connectionId:r})},enabled:!!e&&!!r&&n,staleTime:1/0,refetchOnWindowFocus:!1,retry:!1})},"useTeamDataConnections",0,()=>{let{getAccessTokenSilently:e,user:r,isAuthenticated:n}=(0,t.useAuth0)(),{data:o}=(0,d.useCurrentTeam)(),s=o?.details?.id;return(0,a.useQuery)({queryKey:["team_data_connections",s],enabled:n&&!!r&&!!s,queryFn:async()=>i({teamId:s,accessToken:await e()}),retry:3,refetchOnWindowFocus:!1})},"useToggleConnectionShareStatus",0,()=>{let{getAccessTokenSilently:e}=(0,t.useAuth0)(),a=(0,n.useQueryClient)(),{data:o}=(0,d.useCurrentTeam)(),s=o?.details?.id;return(0,r.useMutation)({mutationFn:async({connectionId:t,currentlyShared:r})=>{let a=await e();return r?l({teamId:s,connectionId:t,accessToken:a}):u({teamId:s,connectionId:t,accessToken:a})},onSuccess:()=>{a.invalidateQueries({queryKey:["team_data_connections",s]})}})}],756563)},38037,e=>{"use strict";var t=e.i(614677),r=e.i(384347);let a={},n={};function o(e,t){var r;let a=(r=e)&&Array.isArray(r)&&r.length?r.length>1?`I uploaded the files: ${r.map(e=>`\`${e.name}\``).join(", ")}`:`I uploaded the file: \`${r[0].name}\``:"";return(t||(t=""),a)?a+"\n\n"+t:t}function s(e){try{return JSON.parse(e)}catch(e){return null}}function i(e){try{let t=JSON.parse(e);if("string"==typeof t)return JSON.parse(t);return t}catch(e){return null}}function u(e,t){if(null==e)return"";let r=e,o=0;return r=(r=r.replace(/\{?outputs_dict\['?"?(\w+)'?"?\]\}?/g,(e,r)=>{if(r in a){let e=a[r];if(e.indexOf("[JULIUS_TABLE]:")>-1)o+=1,e=`<juliusdataframe julius_message_id="${t}" julius_df_selector_index="${o.toString()}">${e}</juliusdataframe>`;else try{let t=e.trim();(t.startsWith("{")&&t.endsWith("}")||t.startsWith("[")&&t.endsWith("]"))&&(JSON.parse(t),e=`<juliusjson>${e}</juliusjson>`)}catch{}return e}return e})).replace(/\{?image_url(?:s)?_dict\['?"?(\w+)'?"?\]\}?/g,(e,t,a)=>{if(t in n){let e=`![alt](${n[t]})`,o=r.slice(Math.max(0,a-2),a),s="\n\n"===o,i=o.endsWith("\n");return s?e:i?"\n"+e:"\n\n"+e}return e})}function l({messages:e,options:a={collapseAllCode:!1},conversationPlan:n,isNotebookMode:o=!1}){if(!n&&(!e||0===e.length||!Array.isArray(e)))return[];let s=a.collapseAllCode,i=[],u=[],l=[],c={},d={};n?.steps?.forEach(e=>{if("markdown"===e.role){let t=[{...e,plan_step_id:e.id,group_idx:u.length,is_last_group:!0,display:e.display,content:e.content}];u.push(t)}else{let t=[{role:"user"===e.role?"userInput":"markdown"===e.role?"markdown":e?.role===r.WorkflowRole.agent?"workflowAgent":void 0,userInputType:e?.userInputType,message_list:[e],first_message_id:e.message_id,plan_step_id:e.id,group_idx:u.length,is_last_group:!0}];u.push(t)}c[e.id]=u.length-1,d[e.id]=e.display});let p={role:void 0,message_list:[],first_message_id:void 0,plan_step_id:void 0,group_idx:"start"},m=e=>{let t=e.group_idx;["start",void 0].includes(t)?i.push({...e}):"end"===t?l.push({...e}):u[t]&&"markdown"!==e.role?u[t].push({...e}):u[t]=e};for(let a of e){let e,n={...a};if("user"===n.role){if(e="user",o&&"assistant"===n.workflow_step_for&&d[n.plan_step_id]===n.content)continue}else"userInput"===n.role?(e="userInput",n.workflow_step_for="user-input"):e="skeleton"===n.role?"skeleton":"system"===n.role?"system":"markdown"===n.role?"markdown":"assistant";!n.function_call||!s||"isCollapsed"in n||(n.isCollapsed=s);let i=o?n.plan_step_id:"start",u=c[i],l=null;if(l="start"===i?"start":void 0!==u?u:"end",n.workflow_step_for&&"assistant"!==n.workflow_step_for&&n.workflow_step_for!==r.WorkflowRole.agent&&"user-input"!==n.workflow_step_for&&(p.message_list.length>0&&(m(p),p={role:void 0,message_list:[],first_message_id:void 0,plan_step_id:void 0,group_idx:l}),!o)){m({role:"workflow_step",content:n.content,workflow_step_for:n.workflow_step_for,message_id:n.message_id,plan_step_id:"end"});continue}if(["userInput","skeleton","system","markdown"].includes(e)){p.message_list.length>0&&(m(p),p={role:void 0,message_list:[],first_message_id:void 0,plan_step_id:i,group_idx:l}),m("markdown"===e?{...n,first_message_id:n.message_id||(0,t.v4)(),plan_step_id:n.plan_step_id,group_idx:l}:o?{role:p.role,message_list:[n],first_message_id:void 0,plan_step_id:n.plan_step_id,group_idx:l}:{...n,first_message_id:void 0,plan_step_id:n.plan_step_id,group_idx:l});continue}let h=p.message_list.some(e=>e.workflow_step_for===n.workflow_step_for&&n.workflow_step_for);void 0===p.role||p.role!==e||n.workflow_step_for!==p.message_list[0]?.workflow_step_for||n.plan_step_id!==p.plan_step_id||h?(p.message_list.length>0&&m(p),p={role:e,message_list:[n],first_message_id:n.message_id,plan_step_id:n.plan_step_id,group_idx:l}):p.message_list.push(n)}p.message_list.length>0&&m(p);let h=[...i.map(e=>({...e,realGroup:"start"})),...u.flat().map(e=>({...e,realGroup:"middle"})),...l.map(e=>({...e,realGroup:"end"}))];if(h.length>0&&(h[h.length-1].is_last_group=!0),o)for(let e of h)e.is_last_group=!0;return h}let c={messageIdsCollapsed:new Set,editingUserMessage:null,messageIdsToSearchResults:{},messageIdToError:{}};function d(e,t){switch(t.type){case"SET_EDITING_USER_MESSAGE":return{...e,editingUserMessage:t.messageId};case"ADD_SEARCH_RESULTS":return{...e,messageIdsToSearchResults:{...e.messageIdsToSearchResults,[t.messageId]:t.searchResults}};case"ADD_ERROR":return{...e,messageIdToError:{...e.messageIdToError,[t.messageId]:t.error}};default:return e}}e.s(["getLocaleDateTimeString",0,e=>new Date(e).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0}),"getMessageGroups",()=>l,"getTextWithUploadsMessage",()=>o,"globalImageUrlsDict",0,n,"globalOutputsDict",0,a,"initialState",0,c,"messageGroupReducer",()=>d,"replaceOutputsAndImagesFromGlobalDicts",()=>u,"safeParseJSON",()=>s,"safeParseJSONMatt",()=>i])},614677,e=>{"use strict";let t,r="undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),a=new Uint8Array(16),n=[];for(let e=0;e<256;++e)n.push((e+256).toString(16).slice(1));e.s(["v4",0,function(e,o,s){if(r&&!o&&!e)return r();var i=e,u=s;let l=(i=i||{}).random??i.rng?.()??function(){if(!t){if("undefined"==typeof crypto||!crypto.getRandomValues)throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");t=crypto.getRandomValues.bind(crypto)}return t(a)}();if(l.length<16)throw Error("Random bytes length must be >= 16");if(l[6]=15&l[6]|64,l[8]=63&l[8]|128,o){if((u=u||0)<0||u+16>o.length)throw RangeError(`UUID byte range ${u}:${u+15} is out of buffer bounds`);for(let e=0;e<16;++e)o[u+e]=l[e];return o}return function(e,t=0){return(n[e[t+0]]+n[e[t+1]]+n[e[t+2]]+n[e[t+3]]+"-"+n[e[t+4]]+n[e[t+5]]+"-"+n[e[t+6]]+n[e[t+7]]+"-"+n[e[t+8]]+n[e[t+9]]+"-"+n[e[t+10]]+n[e[t+11]]+n[e[t+12]]+n[e[t+13]]+n[e[t+14]]+n[e[t+15]]).toLowerCase()}(l)}],614677)},384347,e=>{"use strict";var t,r,a=((t={}).user="user",t.markdown="markdown",t.evaluation="evaluation",t.agent="agent",t.sqlEditor="sql-editor",t),n=((r={}).text="text",r.file="file",r.secrets="secrets",r.code="code",r);e.s(["WorkflowInputType",()=>n,"WorkflowRole",()=>a])},602246,e=>{"use strict";e.s(["getWorkflowQueryKey",0,e=>["workflow",e]])},562920,392331,e=>{"use strict";var t=e.i(52563),r=e.i(954616),a=e.i(266027),n=e.i(912598),o=e.i(394073),s=e.i(647163);let i=async({teamId:e,accessToken:t})=>{let r=await (0,s.customFetch)(`${o.BASE_API}/teams/${e}/groups`,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(!r.ok)throw await r.json();let a=await r.json();return a?.groups},u=async({teamId:e,groupId:t,accessToken:r})=>{let a=await (0,s.customFetch)(`${o.BASE_API}/teams/${e}/groups/${t}/members`,{headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}});if(!a.ok)throw await a.json();let n=await a.json();return n?.members},l=async({teamId:e,groupId:t,email:r,accessToken:a})=>{let n=await fetch(`${o.BASE_API}/teams/${e}/groups/${t}/members`,{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({user_email:r})});if(!n.ok)throw await n.json();let s=await n.json();return s?.member},c=async({teamId:e,groupId:t,email:r,accessToken:a})=>{let n=await fetch(`${o.BASE_API}/teams/${e}/groups/${t}/members`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({user_email:r})});if(!n.ok)throw await n.json();let s=await n.json();return s?.deleted},d=async({accessToken:e,teamId:t,groupName:r})=>{let a=await (0,s.customFetch)(`${o.BASE_API}/teams/${t}/groups`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({name:r})});if(!a.ok)throw await a.json();let n=await a.json();return n?.group},p=async({teamId:e,groupId:t,accessToken:r})=>{let a=await fetch(`${o.BASE_API}/teams/${e}/groups/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${r}`}});if(!a.ok)throw await a.json();let n=await a.json();return n?.deleted},m=async({accessToken:e,conversationId:t,teamId:r,groupId:a,share:n})=>{let i=await (0,s.customFetch)(`${o.BASE_API}/api/chat/${t}/group_share`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({team_id:r,group_id:a,share:n})});if(!i.ok)throw await i.json();return i.json()},h=async({conversationId:e,accessToken:t})=>{let r=await (0,s.customFetch)(`${o.BASE_API}/api/chat/${e}/group_share`,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(!r.ok)throw await r.json();return r.json()},y=async({workflowId:e,accessToken:t})=>{let r=await (0,s.customFetch)(`${o.BASE_API}/workflows/${e}/group_share`,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(!r.ok)throw await r.json();return r.json()},g=async({accessToken:e,workflowId:t,teamId:r,groupId:a,share:n})=>{let i=await (0,s.customFetch)(`${o.BASE_API}/workflows/${t}/group_share`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({team_id:r,group_id:a,share:n})});if(!i.ok)throw await i.json();return i.json()};e.s(["addGroupMember",0,l,"createGroup",0,d,"getConversationGroupShares",0,h,"getTeamGroups",0,i,"getTeamMembers",0,u,"getWorkflowGroupShares",0,y,"removeGroup",0,p,"removeGroupMember",0,c,"shareConversationWithTeamGroup",0,m,"shareWorkflowWithTeamGroup",0,g],392331),e.s(["useAddGroup",0,()=>{let{getAccessTokenSilently:e}=(0,t.useAuth0)(),a=(0,n.useQueryClient)();return(0,r.useMutation)({mutationFn:async({teamId:t,groupName:r})=>{let a=await e();return await d({teamId:t,groupName:r,accessToken:a})},onMutate:async e=>{await a.cancelQueries({queryKey:["team_groups",e.teamId]});let t=a.getQueryData(["team_groups",e.teamId]);return a.setQueryData(["team_groups",e.teamId],t=>t?[...t,{name:e.groupName,team_id:e.teamId,created_at:"",created_by:"",id:`temp-${Date.now()}`,updated_at:""}]:t),{previousData:t}},onSuccess:(e,t)=>{a.setQueryData(["team_groups",t.teamId],t=>t?t.map(t=>t.name===e.name?e:t):[e])},onError:(e,t,r)=>{throw r?.previousData&&a.setQueryData(["team_groups",t.teamId],r.previousData),Error(e?.error)}})},"useAddGroupMember",0,()=>{let{getAccessTokenSilently:e}=(0,t.useAuth0)(),a=(0,n.useQueryClient)();return(0,r.useMutation)({mutationFn:async({teamId:t,groupId:r,email:a})=>{let n=await e();return await l({teamId:t,groupId:r,email:a,accessToken:n})},onMutate:async e=>{await a.cancelQueries({queryKey:["team_group_members",e.teamId,e.groupId]});let t=a.getQueryData(["team_group_members",e.teamId,e.groupId]);return a.setQueryData(["team_group_members",e.teamId,e.groupId],t=>t?[...t,{created_at:"",id:"",updated_at:"",group_id:e.groupId,user_email:e.email}]:t),{previousData:t}},onSuccess:(e,t)=>{a.setQueryData(["team_group_members",t.teamId,t.groupId],t=>t?t.map(t=>t.user_email===e.user_email?e:t):[e])},onError:(e,t,r)=>{throw r?.previousData&&a.setQueryData(["team_group_members",t.teamId,t.groupId],r.previousData),Error(e?.error)}})},"useConversationGroupShares",0,e=>{let{getAccessTokenSilently:r,user:n,isAuthenticated:o}=(0,t.useAuth0)();return(0,a.useQuery)({queryKey:["conversation_group_shares",e],enabled:o&&!!n&&!!e,queryFn:async()=>h({conversationId:e,accessToken:await r()}),retry:3,refetchOnWindowFocus:!1})},"useRemoveGroup",0,()=>{let{getAccessTokenSilently:e}=(0,t.useAuth0)(),a=(0,n.useQueryClient)();return(0,r.useMutation)({mutationFn:async({teamId:t,groupId:r})=>{let a=await e();return await p({teamId:t,groupId:r,accessToken:a})},onMutate:async({teamId:e,groupId:t})=>{await a.cancelQueries({queryKey:["team_groups",e]});let r=a.getQueryData(["team_groups",e]);return a.setQueryData(["team_groups",e],e=>e?e.filter(e=>e.id!==t):e),{previousData:r}},onError:(e,t,r)=>{r?.previousData&&a.setQueryData(["team_groups",t.teamId],r.previousData)},onSettled:(e,t,r)=>{a.invalidateQueries({queryKey:["team_group_members",r.teamId,r.groupId]})}})},"useRemoveGroupMember",0,()=>{let{getAccessTokenSilently:e}=(0,t.useAuth0)(),a=(0,n.useQueryClient)();return(0,r.useMutation)({mutationFn:async({teamId:t,groupId:r,email:a})=>{let n=await e();return await c({teamId:t,groupId:r,email:a,accessToken:n})},onMutate:async({teamId:e,groupId:t,email:r})=>{await a.cancelQueries({queryKey:["team_group_members",e,t]});let n=a.getQueryData(["team_group_members",e,t]);return a.setQueryData(["team_group_members",e,t],e=>e?e.filter(e=>e.user_email!==r):e),{previousMembers:n}},onError:(e,t,r)=>{r?.previousMembers&&a.setQueryData(["team_group_members",t.teamId,t.groupId],r.previousMembers)},onSettled:(e,t,r)=>{a.invalidateQueries({queryKey:["team_group_members",r.teamId,r.groupId]})}})},"useShareConversationWithGroup",0,()=>{let{getAccessTokenSilently:e}=(0,t.useAuth0)(),a=(0,n.useQueryClient)();return(0,r.useMutation)({mutationFn:async({conversationId:t,teamId:r,groupId:a,share:n})=>{let o=await e();return await m({accessToken:o,conversationId:t,teamId:r,groupId:a,share:n})},onMutate:async({conversationId:e,teamId:t,groupId:r,share:n})=>{await a.cancelQueries({queryKey:["conversation_group_shares",e]});let o=a.getQueryData(["conversation_group_shares",e]);return a.setQueryData(["conversation_group_shares",e],a=>{if(!a)return a;let o=a.find(e=>e.team_id===t&&e.group_id===r);return n?o?a:[...a,{id:"",conversation_id:e,team_id:t,group_id:r,role:"viewer",created_at:"",updated_at:""}]:a.filter(e=>e.team_id!==t||e.group_id!==r)}),{previousData:o}},onError:(e,t,r)=>{r?.previousData&&a.setQueryData(["conversation_group_shares",t.conversationId],r.previousData)},onSettled:(e,t,r)=>{a.invalidateQueries({queryKey:["conversation_group_shares",r.conversationId]})}})},"useShareWorkflowWithGroup",0,()=>{let{getAccessTokenSilently:e}=(0,t.useAuth0)(),a=(0,n.useQueryClient)();return(0,r.useMutation)({mutationFn:async({workflowId:t,teamId:r,groupId:a,share:n})=>{let o=await e();return await g({accessToken:o,workflowId:t,teamId:r,groupId:a,share:n})},onMutate:async({workflowId:e,teamId:t,groupId:r,share:n})=>{await a.cancelQueries({queryKey:["workflow_group_shares",e]});let o=a.getQueryData(["workflow_group_shares",e]);return a.setQueryData(["workflow_group_shares",e],a=>{if(!a)return a;let o=a.find(e=>e.team_id===t&&e.group_id===r);return n?o?a:[...a,{id:"",plan_id:e,team_id:t,group_id:r,role:"viewer",created_at:"",updated_at:""}]:a.filter(e=>e.team_id!==t||e.group_id!==r)}),{previousData:o}},onError:(e,t,r)=>{r?.previousData&&a.setQueryData(["workflow_group_shares",t.workflowId],r.previousData)},onSettled:(e,t,r)=>{a.invalidateQueries({queryKey:["workflow_group_shares",r.workflowId]})}})},"useTeamGroups",0,e=>{let{getAccessTokenSilently:r,user:n,isAuthenticated:o}=(0,t.useAuth0)();return(0,a.useQuery)({queryKey:["team_groups",e],enabled:o&&!!n&&!!e,queryFn:async()=>i({teamId:e,accessToken:await r()}),retry:3,refetchOnWindowFocus:!1})},"useTeamGroupsMembers",0,(e,r)=>{let{getAccessTokenSilently:n,user:o,isAuthenticated:s}=(0,t.useAuth0)();return(0,a.useQuery)({queryKey:["team_group_members",e,r],enabled:s&&!!o&&!!e&&!!r&&!r.startsWith("temp-"),queryFn:async()=>u({teamId:e,groupId:r,accessToken:await n()}),retry:3,refetchOnWindowFocus:!1})},"useWorkflowGroupShares",0,e=>{let{getAccessTokenSilently:r,user:n,isAuthenticated:o}=(0,t.useAuth0)();return(0,a.useQuery)({queryKey:["workflow_group_shares",e],enabled:o&&!!n&&!!e,queryFn:async()=>y({workflowId:e,accessToken:await r()}),retry:1,refetchOnWindowFocus:!1})}],562920)}]);

//# debugId=6e17247b-cad5-d522-cf1c-cbc4fb6d9318
//# sourceMappingURL=bac0420417dd7ca8.js.map