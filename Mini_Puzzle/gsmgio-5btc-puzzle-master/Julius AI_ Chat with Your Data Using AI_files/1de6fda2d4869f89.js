;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="9d7843fa-128b-c69f-7643-5b41f4bc1b51")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,413801,e=>{"use strict";var t=e.i(843476),n=e.i(271645);e.i(768549);var a=e.i(757383),s=e.i(912598),r=e.i(657688),i=e.i(618566),l=e.i(846696),o=e.i(544216),c=e.i(796610),d=e.i(167881),u=e.i(630374),m=e.i(127341),h=e.i(367944),x=e.i(851984),f=e.i(285794),p=e.i(604570);let g={databricks:{videoId:"DAckcJI1WeY",title:"databricks connector tutorial"},sqlserver:{videoId:"bQWpMRthtzM",title:"sql server connector tutorial"},postgres:{videoId:"vekSLzag7Bo",title:"postgres connector tutorial"},"meta-ads":{videoId:"aKHuBSCZpow",title:"meta ads connector tutorial"},mysql:{videoId:"G64s6MYk7hE",title:"mysql connector tutorial"}};var j=e.i(620949),v=e.i(690206),y=e.i(135385),b=e.i(878894),N=e.i(664659);let w=()=>{let[e,a]=(0,n.useState)(!1);return(0,t.jsxs)("div",{className:"mt-4 bg-orange-50 border border-orange-200 rounded-md text-left",children:[(0,t.jsx)("button",{type:"button",className:"w-full flex items-center px-4 py-2 text-sm text-orange-800 text-left gap-2",onClick:()=>a(e=>!e),"aria-expanded":e,children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(b.AlertTriangle,{className:"w-4 h-4 text-orange-600 flex-shrink-0 mt-0.5"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("p",{className:"font-medium",children:"Supabase connections require a connection pooler"}),(0,t.jsx)(N.ChevronDown,{className:`w-4 h-4 transform transition-transform ${e?"rotate-180":""}`})]})]})}),e&&(0,t.jsxs)("div",{className:"px-4 pb-4 pt-2 text-sm text-orange-800 space-y-2 border-t border-orange-200",children:[(0,t.jsx)("p",{className:"font-medium",children:"Connection Pooler Required"}),(0,t.jsx)("p",{children:"For Supabase connections, you must use a connection pooler instead of the direct connection string. Use either:"}),(0,t.jsxs)("ul",{className:"list-disc list-inside space-y-1 ml-2",children:[(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Session mode"})," - For persistent applications"]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Transaction mode"})," - For serverless/edge functions"]})]}),(0,t.jsx)("a",{href:"https://supabase.com/docs/guides/database/connecting-to-postgres",target:"_blank",rel:"noopener noreferrer",className:"text-orange-700 underline hover:text-orange-900",children:"Learn more about Supabase connection pooling →"})]})]})},C=({connector:e,internalMode:a,availableModes:s,selectedMode:i,setSelectedMode:l,currentError:o,schemaWithConnectionName:c,formData:m,setFormData:h,uiSchema:x,validator:b,transformErrors:N,handleChange:C,handleSubmit:k,isProcessing:S,handleCancel:_,existingConnection:A,warning:T,documentationUrl:D})=>{var L;let[I,z]=(0,n.useState)(null),{data:O}=(0,j.useUserSubscription)(),F=g[e.name.toLowerCase()],B=(0,n.useRef)(null),M=(0,n.useCallback)(e=>{l(e.target.value),h(e=>({connectionName:e.connectionName||""}))},[l,h]);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u.DialogHeader,{children:(0,t.jsx)(u.DialogTitle,{children:"edit"===a?`Edit ${e.name} Connector`:`Create ${e.name} Connector`})}),(0,t.jsxs)("div",{className:"flex flex-col flex-1 h-full min-h-0",children:[(0,t.jsxs)("div",{className:"flex-1 grid grid-cols-1 md:grid-cols-2 gap-6 mt-5 overflow-y-auto",children:[(0,t.jsxs)("div",{className:"space-y-4",children:[s&&s.length>1&&(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2 text-foreground",children:"Mode"}),(0,t.jsx)("select",{className:"w-full border rounded p-2 bg-background text-foreground",value:i||"",onChange:M,children:s?.map(n=>(0,t.jsx)("option",{value:n,children:e.schema.modes[n]?.display||n},n))})]}),"edit"===a&&(0,t.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-3",children:(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[(0,t.jsx)("div",{className:"flex-shrink-0 mt-0.5",children:(0,t.jsx)("svg",{className:"w-4 h-4 text-blue-600",fill:"currentColor",viewBox:"0 0 20 20",children:(0,t.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),(0,t.jsxs)("div",{className:"text-sm text-blue-800",children:[(0,t.jsx)("p",{className:"font-medium mb-1",children:"Editing Connection"}),(0,t.jsx)("p",{children:"All fields will be updated with whatever you enter below. You must re-enter sensitive fields"})]})]})}),o&&(0,t.jsx)("div",{className:"bg-destructive/5 border border-destructive/15 rounded-md p-4",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"flex-shrink-0 mt-0.5",children:(0,t.jsx)("div",{className:"w-5 h-5 rounded-full bg-red-100 flex items-center justify-center",children:(0,t.jsx)("svg",{className:"w-3 h-3 text-red-600",fill:"currentColor",viewBox:"0 0 20 20",children:(0,t.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("h4",{className:"text-sm font-semibold text-red-800 mb-1",children:"edit"===a?"Update failed":"Connection failed"}),(0,t.jsx)("p",{className:"text-sm text-red-700 break-words whitespace-pre-wrap overflow-wrap-anywhere",children:o?.message?.includes("timed out")?"Connection test timed out. Please check your credentials and try again.":o?.message?.includes("cancelled")?"Connection test timed out, please check your connection details and try again, contact team@julius.ai if the problem persists":o?.message?.includes("signal is aborted")?"Connection test was interrupted. Please try again.":o?.message||`An error occurred during ${"edit"===a?"connection update":"connection test"}`})]})]})}),c?(0,t.jsx)("div",{ref:B,onBlur:e=>{let t=e.relatedTarget;B.current?.contains(t)||z(null)},children:(0,t.jsx)(f.default,{id:"connector-form",schema:c,uiSchema:{...x,"ui:submitButtonOptions":{norender:!0}},formData:m,validator:b,transformErrors:N,onChange:C,onSubmit:k,disabled:S,showErrorList:!1,widgets:v.widgets,templates:{FieldTemplate:v.CustomFieldTemplate},formContext:{setFocusedField:z},customValidate:(e,t)=>{let n=e?.host;if("string"==typeof n){let e=n.trim(),a=c?.properties?.host;for(let[n,s]of Object.entries(a?.frontend_validation_messages||{})){if(!n||!s)continue;let{message:a,documentation:r}=s;if(a)try{if(RegExp(n,"i").test(e)){let e=t.host;if(e?.addError?.(a),r?.url){let t=r.linktext||"Read the Documentation";e?.addError?.(`DOC_LINK|${r.url}|${t}`)}}}catch(e){console.error(`Invalid regex pattern in config: ${n}`,e)}}}return t},className:"space-y-4 connector-dialog-form"})}):(0,t.jsx)("div",{className:"space-y-4",children:[1,2].map(e=>(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("div",{className:"h-4 w-24 bg-muted rounded animate-pulse"}),(0,t.jsx)("div",{className:"h-10 w-full bg-muted rounded animate-pulse"})]},e))})]}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"rounded-lg p-6 text-center",children:[e.light_logo_url&&(0,t.jsx)("div",{className:"flex justify-center mb-4",children:(0,t.jsx)(r.default,{src:e.light_logo_url,alt:e.name,width:48,height:48,className:"h-12 w-12 object-contain"})}),(0,t.jsx)("h3",{className:"text-lg font-medium text-foreground",children:m?.connectionName||A?.name||e.name})]}),"Supabase"===e.name&&(0,t.jsx)(w,{}),(0,t.jsxs)("div",{className:"space-y-2 text-sm text-muted-foreground",children:[T&&(0,t.jsxs)("div",{className:"border border-yellow-400 rounded-md p-3 mt-4 bg-background flex items-center gap-2",children:[(0,t.jsx)("svg",{className:"w-4 h-4 text-yellow-500 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:(0,t.jsx)("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),(0,t.jsx)("span",{className:"text-sm text-yellow-700 break-words whitespace-pre-wrap",children:T})]}),I?(0,t.jsxs)("div",{className:"bg-surface-1 rounded-lg py-3 px-4 shadow-ring-sm space-y-1",children:[I?.label&&(0,t.jsx)("h4",{className:"text-base font-medium text-foreground",children:I.label}),I?.help&&(0,t.jsx)("div",{className:"text-foreground",children:I.help})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{children:"edit"===a?`Update your ${e.name} connection credentials. The connection will be tested after updating.`:`Data Connectors allows you to connect to data sources like ${e.name} by securely providing your credentials to the AI.`}),"create"===a&&(0,t.jsx)("p",{children:"Once a connector is enabled, it is available for the entire chat, allowing the AI to access and query your data contextually across interactions."}),"Zapier"===e.name&&(0,t.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-4 space-y-2",children:(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[(0,t.jsx)("div",{className:"flex-shrink-0 mt-0.5",children:(0,t.jsx)("svg",{className:"w-4 h-4 text-blue-600",fill:"currentColor",viewBox:"0 0 20 20",children:(0,t.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),(0,t.jsx)("div",{className:"text-sm text-blue-800",children:(0,t.jsx)("p",{children:"Each OAuth client can only be linked to one server. If the OAuth client you're using is already connected to another server, that server will be used instead of this one."})})]})})]}),(0,t.jsxs)("div",{className:"",children:[F&&(0,t.jsx)("div",{className:"pt-2",children:(0,t.jsxs)("a",{href:(L=F.videoId,`https://www.youtube.com/watch?v=${L}`),target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline inline-flex items-center gap-1",children:["Watch setup tutorial",(0,t.jsx)(y.default,{})]})}),(0,t.jsx)("div",{className:"pt-2",children:(0,t.jsxs)("a",{href:"#",className:"text-primary hover:underline inline-flex items-center gap-1",onClick:e=>{e.preventDefault(),window.open(D||"/docs/data-connectors/overview","_blank")},children:["Read the Documentation",(0,t.jsx)(y.default,{})]})}),(0,t.jsx)("div",{className:"pt-2",children:(0,t.jsxs)("a",{href:"https://trust.julius.ai",target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline inline-flex items-center gap-1 pb-3",children:["Security & Trust Center",(0,t.jsx)(y.default,{})]})})]})]})]})]}),(0,t.jsxs)("div",{className:"mt-auto pt-6 flex gap-2",children:[(0,t.jsx)(d.Button,{form:"connector-form",type:"submit",disabled:S||!c,className:"flex-1",onClick:()=>{p.default.capture("edit"===a?"settings:data-connectors:connector-edit-connection-clicked":"settings:data-connectors:connector-add-connection-clicked",{connector_name:e?.name,connector_id:e?.id,..."edit"===a&&{connection_id:A?.id},is_free_user:!O?.status})},children:S?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin mr-2"}),"Testing Connection..."]}):"edit"===a?"Update & Test Connection":"Add Connection"}),S&&(0,t.jsx)(d.Button,{type:"button",variant:"outline",onClick:_,className:"px-4",children:"Cancel"})]})]})]})};var k=e.i(292999),S=e.i(52563),_=e.i(531278),A=e.i(213248),T=e.i(184762);let D=({connectionId:e,initialDataDictionary:a=""})=>{let{getAccessTokenSilently:s}=(0,S.useAuth0)(),[r,i]=(0,n.useState)(!1),[o,c]=(0,n.useState)(a||""),u=async()=>{if(e){i(!0);try{let t=await s();await (0,A.updateDataDictionaryRawText)({accessToken:t,connectionId:e,dataDictionaryRawText:o}),l.toast.success("Data dictionary saved")}catch(e){console.error(e),l.toast.error("Failed to save data dictionary")}finally{i(!1)}}};return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Add custom documentation or a data dictionary for this connection."}),(0,t.jsxs)("div",{className:"bg-muted/50 rounded-lg p-4 space-y-2",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-foreground",children:"Include details like:"}),(0,t.jsxs)("ul",{className:"text-sm text-muted-foreground space-y-1.5 ml-4",children:[(0,t.jsxs)("li",{className:"flex items-start",children:[(0,t.jsx)("span",{className:"text-muted-foreground/70 mr-2",children:"•"}),(0,t.jsx)("span",{children:"Column definitions and data types"})]}),(0,t.jsxs)("li",{className:"flex items-start",children:[(0,t.jsx)("span",{className:"text-muted-foreground/70 mr-2",children:"•"}),(0,t.jsx)("span",{children:"Business rules and calculations"})]}),(0,t.jsxs)("li",{className:"flex items-start",children:[(0,t.jsx)("span",{className:"text-muted-foreground/70 mr-2",children:"•"}),(0,t.jsx)("span",{children:"Allowed values and constraints"})]}),(0,t.jsxs)("li",{className:"flex items-start",children:[(0,t.jsx)("span",{className:"text-muted-foreground/70 mr-2",children:"•"}),(0,t.jsx)("span",{children:"Data refresh schedules or notes about data quality"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{htmlFor:"data-dictionary",className:"text-sm font-medium",children:"Data Dictionary"}),(0,t.jsx)(T.Textarea,{id:"data-dictionary",value:o,onChange:e=>c(e.target.value),placeholder:"Enter your data dictionary here...",className:"min-h-[200px] resize-none",disabled:r}),(0,t.jsxs)("div",{className:"text-xs text-muted-foreground",children:[o.length," characters"]})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-2 pt-2",children:[(0,t.jsx)(d.Button,{variant:"outline",onClick:()=>{c(a||"")},disabled:r,children:"Cancel"}),(0,t.jsx)(d.Button,{onClick:u,disabled:r||!e||o===(a||""),children:r?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(_.Loader2,{className:"w-4 h-4 animate-spin mr-2"})," Saving..."]}):"Save Data Dictionary"})]})]})};var L=e.i(178583),I=e.i(323441),z=e.i(625959),O=e.i(471435);let F=({connectionId:e})=>{let{getAccessTokenSilently:a}=(0,S.useAuth0)(),[s,r]=(0,n.useState)(!1),[i,o]=(0,n.useState)(!1),[c,u]=(0,n.useState)([]),[m,h]=(0,n.useState)({}),[x,f]=(0,n.useState)({}),p=(0,n.useMemo)(()=>{let e={};for(let t of c)e[t.name]=Array.isArray(t.columns)?t.columns:[];return e},[c]);(0,n.useEffect)(()=>{let t=!0;return(async()=>{if(e){r(!0);try{let n=await a(),s=await (0,A.getConnectionSchemaWithFilter)({accessToken:n,connectionId:e}),r=s?.schema??[],i=new Set,l=new Set,o=new Set,c={};for(let e of r){let t=e.schema_name||"",n=e.table_name||"",a=e.column_name||"";if("schema"===e.level&&e.filtered_out)i.add(t);else if("table"===e.level&&e.filtered_out){let e=t?`${t}.${n}`:n;l.add(e)}else if("column"===e.level){let s=t?`${t}.${n}`:n,r=`${s}.${a}`;c[s]||(c[s]=[]),c[s].push(a),e.filtered_out&&o.add(r)}}let d=[],m={};for(let[e,t]of Object.entries(c)){d.push({name:e,columns:t});let n=e.includes(".")?e.split("."):[e];n.pop();let a=n.length>0?n.join("."):"",s=a&&i.has(a),r=l.has(e);if(s||r)continue;let c=t.filter(t=>!o.has(`${e}.${t}`));c.length===t.length?m[e]="ALL":c.length>0&&(m[e]=new Set(c))}t&&(u(d),f(m),h(m))}catch(e){console.error(e),l.toast.error("Failed to load schema")}finally{t&&r(!1)}}})(),()=>{t=!1}},[e,a]);let g=(0,n.useMemo)(()=>{let e=e=>{let t=[];for(let[n,a]of Object.entries(e)){let e="ALL"===a?[...p[n]||[]]:Array.from(a);t.push({table:n,columns:e.sort()})}return JSON.stringify(t.sort((e,t)=>e.table.localeCompare(t.table)))};return e(m)!==e(x)},[m,x,p]),j=async()=>{if(e){o(!0);try{let t=await a(),n=(e=>{let t=[];for(let n of c){let a=n.name.split("."),s=a.pop()||n.name,r=a.length>0?a.join("."):"",i=e[n.name];if(!i){t.push({schema_name:r,table_name:s,column_name:""});continue}let l="ALL"===i?new Set(n.columns):i instanceof Set?i:new Set;for(let e of n.columns)l.has(e)||t.push({schema_name:r,table_name:s,column_name:e})}return t})(x);await (0,A.updateConnectionFilteredSchema)({accessToken:t,connectionId:e,filteredSchema:n}),h(x),l.toast.success("Filtered schema saved")}catch(e){console.error(e),l.toast.error("Failed to save filtered schema")}finally{o(!1)}}};return(0,t.jsxs)("div",{className:"flex flex-col gap-3 h-full min-h-0",children:[(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"Select the tables and columns to include in this connection’s filtered schema."}),(0,t.jsx)("div",{className:"border rounded-md flex-1 min-h-0",children:(0,t.jsx)(O.ScrollArea,{className:"h-[40vh] md:h-[50vh] p-3",children:s?(0,t.jsx)("div",{className:"flex items-center justify-center h-full text-sm text-muted-foreground",children:"Loading schema..."}):0===c.length?(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"No schema found."}):(0,t.jsx)("div",{className:"space-y-2",children:c.map(e=>{var n;let a,s=!!(a=x[(n=e).name])&&("ALL"===a||a instanceof Set&&0!==a.size&&(a.size===n.columns.length||"indeterminate"));return(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("label",{className:"flex items-center gap-2",children:[(0,t.jsx)(z.Checkbox,{checked:s,onCheckedChange:t=>{var n;return n=!!t,void f(t=>{let a={...t};return n?a[e.name]="ALL":delete a[e.name],a})}}),(0,t.jsx)(I.Table,{className:"h-4 w-4 text-muted-foreground"}),(0,t.jsx)("span",{className:"font-medium",children:e.name})]}),e.columns.length>0&&(0,t.jsx)("div",{className:"pl-6 space-y-1",children:e.columns.map(n=>{let a=x[e.name],s="ALL"===a||a instanceof Set&&a.has(n);return(0,t.jsxs)("label",{className:"flex items-center gap-2",children:[(0,t.jsx)(z.Checkbox,{checked:s,onCheckedChange:t=>{var a;return a=!!t,void f(t=>{let s,r={...t},i=r[e.name];return s="ALL"===i?new Set(e.columns):i instanceof Set?new Set(Array.from(i)):new Set,a?s.add(n):s.delete(n),0===s.size?delete r[e.name]:s.size===e.columns.length?r[e.name]="ALL":r[e.name]=s,r})}}),(0,t.jsx)(L.FileText,{className:"h-4 w-4 text-muted-foreground"}),(0,t.jsx)("span",{className:"text-sm text-foreground",children:n})]},n)})})]},e.name)})})})}),(0,t.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,t.jsx)(d.Button,{variant:"outline",onClick:()=>{f(m)},disabled:!g||i,children:"Cancel"}),(0,t.jsx)(d.Button,{onClick:j,disabled:!g||i||!e,children:i?"Saving...":"Save"})]})]})};var B=e.i(756563);let M=({connectionId:e,isFrozen:a,teamId:s})=>{let{mutateAsync:r,isPending:i}=(0,o.useFreezeLearning)(),{mutateAsync:l,isPending:c}=(0,o.useUpdateLearning)(),[u,m]=(0,n.useState)([]),[h,x]=(0,n.useState)(a),[f,g]=(0,n.useState)(null),[j,v]=(0,n.useState)({}),y=(0,n.useRef)(null),b=(0,n.useRef)(null),N=(0,n.useRef)(0),w=()=>`row-${Date.now()}-${++N.current}`,{data:C,refetch:k,isFetching:S}=(0,o.useGetLearning)({connectionId:e,enabled:!s}),{data:_,refetch:A,isFetching:T}=(0,B.useGetTeamConnectionLearning)({teamId:s||"",connectionId:e,enabled:!!s}),D=s?_:C,L=s?A:k,I=s?T:S;(0,n.useEffect)(()=>{if(I||!D||y.current)return;let e=D?.learning_data?.learning||D?.learning_data;e&&Object.keys(e).length>0?(m(Object.entries(e).map(([e,t])=>({id:w(),key:e,value:String(t)}))),y.current=e):(m([]),y.current={})},[I,D]);let z=async t=>{let n={};t.forEach(({key:e,value:t})=>{e&&(n[e]=t)}),p.posthog.capture("settings:data-connectors:update-learned-information",{connection_id:e,learning_data:n});let a=s?(0,B.getTeamConnectionLearningQueryKey)(s,e):(0,o.getLearningQueryKey)(e);await l({connectionId:e,learningData:n,queryKey:a}),y.current=n},O=e=>{v(t=>{let n=[];return(Object.keys(t).forEach(t=>{e.filter(e=>e.key===t&&""!==e.key).length<=1&&n.push(t)}),0===n.length)?t:Object.fromEntries(Object.entries(t).filter(([e])=>!n.includes(e)))})},F=()=>{p.posthog.capture("settings:data-connectors:add-row-to-learned-information",{connection_id:e}),m(e=>[...e,{id:w(),key:"",value:""}]),requestAnimationFrame(()=>{b.current.scrollTop=b.current.scrollHeight})};if(!D&&0===u.length)return(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[(0,t.jsx)("div",{className:"text-muted-foreground text-xs mb-3",children:"No schema information available for this connection."}),(0,t.jsx)(d.Button,{variant:"outline",size:"sm",onClick:F,className:"text-xs h-7",children:"Add Schema Information"})]});let M=async()=>{try{x(e=>!e),p.posthog.capture("settings:data-connectors:freeze-learning",{connection_id:e,set_freeze:!h});let t=s?(0,B.getTeamConnectionLearningQueryKey)(s,e):(0,o.getLearningQueryKey)(e);await r({connectionId:e,setFreeze:!h,queryKey:t})}catch(e){x(e=>!e),console.error("Failed to update freeze state:",e)}};return(0,t.jsxs)("div",{className:"flex flex-col h-full overflow-y-auto",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"Schema Information"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Information discovered about this connection's schema structure"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[c&&(0,t.jsx)("span",{className:"text-xs text-muted-foreground animate-pulse",children:"Saving changes..."}),(0,t.jsx)(d.Button,{variant:"secondary",size:"sm",onClick:()=>void L(),children:"Refresh"}),(0,t.jsxs)(d.Button,{variant:h?"default":"secondary",size:"sm",onClick:M,disabled:i,children:[h?"Unfreeze":"Freeze"," Schema"]})]})]}),h&&(0,t.jsxs)("div",{className:"mb-4 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-2 h-2 bg-amber-500 rounded-full"}),(0,t.jsx)("span",{className:"text-sm font-medium text-amber-800",children:"Schema learning is frozen"})]}),(0,t.jsx)("p",{className:"text-xs text-amber-700 mt-1",children:'Automatic updates are disabled. Click "Unfreeze Schema" to allow changes.'})]}),(0,t.jsx)("div",{ref:b,className:`flex-1 overflow-auto max-h-[428px] ${h?"pointer-events-none opacity-40":"pointer-events-auto opacity-100"}`,children:(0,t.jsx)("div",{className:"border rounded-md overflow-hidden",children:(0,t.jsxs)("table",{className:"w-full",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"border-b bg-muted/50",children:[(0,t.jsx)("th",{className:"w-1/3 text-left py-2 ps-5 pe-2 font-medium text-xs",children:"Property"}),(0,t.jsx)("th",{className:"text-left py-2 ps-5 pe-2 font-medium text-xs",children:"Value"}),(0,t.jsx)("th",{className:"w-12 py-2 px-2"})]})}),(0,t.jsxs)("tbody",{className:"divide-y",children:[0===u.length&&(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:3,className:"py-6 text-center text-muted-foreground text-xs",children:"No schema information available"})}),u.length>0&&u.map(n=>(0,t.jsxs)("tr",{className:"hover:bg-muted/25 transition-colors",children:[(0,t.jsxs)("td",{className:`py-1 px-2 w-1/3 align-top ${j[n.key]&&""!==n.key?"border border-red-500":""}`,children:[(0,t.jsx)("input",{type:"text",defaultValue:n.key,placeholder:"Property name",className:"w-full bg-transparent border-none outline-none focus:ring-0 text-[9px] font-medium",onBlur:e=>{let t=e.target.value.trim();if(t===n.key)return;let a=u.some(e=>e.key===t&&e.id!==n.id&&""!==t),s=u.map(e=>e.id===n.id?{...e,key:t}:e);(m(s),O(s),a)?v(e=>({...e,[t]:"A property with this name already exists."})):z(s)}}),j[n.key]&&(0,t.jsx)("p",{className:"mt-1 text-[9px] text-red-500",children:j[n.key]})]}),(0,t.jsx)("td",{className:"px-2 align-top overflow-y-scroll",children:(0,t.jsx)("textarea",{defaultValue:n.value,onFocus:()=>g(n.id),onBlur:e=>{g(null);let t=e.target.value;t!==n.value&&m(e=>{let a=e.map(e=>e.id===n.id?{...e,value:t}:e);return z(a),a})},placeholder:"Property value",className:`
    w-full border-none outline-none focus:ring-0 text-[9px] resize-none overflow-y-hidden transition-all duration-200
    ${f===n.id?"bg-background text-foreground border border-primary":"bg-transparent"}
  `,rows:f===n.id?8:2,style:{lineHeight:"1.2em",minHeight:f===n.id?"9.6em":"2.4em"}})}),(0,t.jsx)("td",{className:"px-2 text-right align-middle",children:(0,t.jsx)(d.Button,{variant:"ghost",size:"sm",onClick:()=>{var t;let a;return t=n.id,a=u.find(e=>e.id===t),void(p.posthog.capture("settings:data-connectors:delete-row-from-learned-information",{connection_id:e,key:a?.key}),m(e=>{let n=e.filter(e=>e.id!==t);return O(n),z(n),n}))},className:"h-6 w-6 p-0 text-muted-foreground hover:text-destructive",children:"×"})})]},n.id))]})]})})}),(0,t.jsxs)("div",{className:"mt-3 flex items-center justify-between",children:[(0,t.jsxs)(d.Button,{variant:"outline",size:"sm",onClick:F,className:"flex items-center gap-1 text-xs h-7",children:[(0,t.jsx)("span",{className:"text-sm leading-none",children:"+"}),"Add Property"]}),(0,t.jsxs)("div",{className:"text-xs text-muted-foreground",children:[u.length," ",1===u.length?"property":"properties"]})]})]})},E=e=>e.map(e=>(".connectionName"===e.property&&"format"===e.name?e.stack="Connection name must be unique":".connectionName"===e.property&&"pattern"===e.name&&(e.stack="Connection name cannot start with a number"),e));e.s(["default",0,({connector:e,isOpen:f,onOpenChange:p,mode:g="create",existingConnection:j,children:v,initialTab:y="connection",additionalConnectionInfo:b,documentationUrl:N,sharedWithTeam:w=!1})=>{let S=(0,i.useRouter)(),_=(0,s.useQueryClient)(),{data:A}=(0,o.usePublicKey)(),{data:T}=(0,c.useCurrentTeam)(),[L,I]=(0,n.useState)(g),[z,O]=(0,n.useState)(j||null),B=w&&T?.details?.id?T.details.id:void 0,{data:$}=(0,o.useUserConnections)(),P=(0,n.useMemo)(()=>$?new Set("edit"===L?$.map(e=>e.name).filter(e=>e!==z?.name):$?.map(e=>e.name)):new Set,[$,z,L]),R=e=>!P.has(e),q=e?.schema?.available_modes,[U,W]=(0,n.useState)(()=>q?.length?e?.schema?.mode||q[0]:null);(0,n.useEffect)(()=>{q?.length&&W(e?.schema?.mode||q[0])},[e?.id]),(0,n.useEffect)(()=>{j&&O(j)},[j]);let K=["password","secret","key","token","service_account_json"],H=e=>K.some(t=>e.toLowerCase().includes(t)),Q=e?.schema;q?.length&&U&&(Q={...e.schema.modes[U],available_modes:e.schema.available_modes,mode:U});let[V,J]=(0,n.useState)(()=>{if("edit"===L&&z){let e={connectionName:z?.name};if(z?.connection_data)try{let t=JSON.parse(z.connection_data);if(t?.safe_data){let n=Object.entries(t.safe_data).reduce((e,[t,n])=>(H(t)||(e[t]=n),e),{});return{...e,...n}}}catch{}return e}return{}});(0,n.useEffect)(()=>{if(q?.length&&U&&J(e=>({connectionName:e.connectionName||""})),"edit"===L&&z?.connection_data){let e=JSON.parse(z.connection_data);e?.safe_data&&J(t=>({...t,...e.safe_data}))}},[U,e?.id]);let[Y,G]=(0,n.useState)(!1),[Z,X]=(0,n.useState)(null),ee=Q?{...Q,properties:{...b?.connectionName?{}:{connectionName:{title:"Connection Name",type:"string",format:"unique-connection-name",pattern:"^[^0-9].*",tooltip:'A custom name you provide to identify this connection, helpful when managing multiple database connections. Names cannot start with a number. Choose a descriptive name like "Production DB" or "Analytics Warehouse" to easily distinguish between connections.'}},...Object.fromEntries(Object.entries(Q?.properties||{}).filter(([e])=>"connectionName"!==e))},required:[..."create"!==L||b?.connectionName?[]:["connectionName"],...(Q?.required||[]).filter(e=>!("connectionName"===e||"edit"===L&&H(e)))]}:void 0,et={"ui:submitButtonOptions":{norender:!0},...Object.fromEntries((Object.keys(ee?.properties||{})||[]).map(e=>{let t,n=H(e),a=["service_account_json","private_key","json","key_file","certificate"].some(t=>e.toLowerCase().includes(t)),s=ee?.properties?.[e],r=s&&"enum"in s,i=!1,l="";if("edit"===L&&z?.connection_data)try{let t=JSON.parse(z.connection_data);t?.safe_data?.[e]&&(i=!0,l=t.safe_data[e])}catch{}let o={"ui:placeholder":"connectionName"===e?"Enter a name for this connection":"edit"===L?n?`Enter new ${e.toLowerCase()} (leave blank to keep current)`:i?`Current: ${l}`:`Enter new ${e.toLowerCase()} (leave blank to keep current)`:`Enter your ${e.toLowerCase()}`};return t=s||{},(Array.isArray(t?.type)&&t.type.includes("null")||Array.isArray(t?.enum)&&t.enum.includes(null)||[...Array.isArray(t?.anyOf)?t.anyOf:[],...Array.isArray(t?.oneOf)?t.oneOf:[]].some(e=>!!e&&!!(null===e.const||Array.isArray(e?.type)&&e.type.includes("null")||e?.type==="null"||Array.isArray(e?.enum)&&e.enum.includes(null))))&&(o["ui:emptyValue"]=null),s?.tooltip&&(o["ui:help"]=s.tooltip),r||(a&&n?o["ui:widget"]="PasswordTextareaWidget":a?o["ui:widget"]="TextareaWidget":o["ui:widget"]=n?"PasswordWidget":"TextWidget"),[e,o]})),"ui:order":["connectionName",...(ee?.required||[]).filter(e=>"connectionName"!==e),"*"]},en=async e=>{let t=window.open(e,"_blank","noopener,noreferrer");if(!t){window.location.href=e,await new Promise(()=>{});return}await new Promise(e=>{let n=setInterval(()=>{t.closed&&(clearInterval(n),e())},500)})},{mutateAsync:ea,data:es,isPending:er,error:ei,reset:el}=(0,o.useUpdateConnection)(),{mutateAsync:eo,data:ec,isPending:ed,error:eu,reset:em}=(0,o.useCreateConnection)({connectorId:e.id,publicKey:A}),eh=(0,o.useEnableConnectionStream)(),{mutateAsync:ex}=(0,o.useDeleteConnection)(),{setModal:ef,setModalProps:ep}=(0,h.useChatContext)(),eg=async t=>{let n=new AbortController;X(n);try{let{connectionName:a,...s}=t.formData,r=b?.connectionName||a;b&&Object.assign(s,b),q?.length&&U&&(s.mode=U),e?.name==="Zapier"&&"string"==typeof s?.mcp_oauth_url&&(s.endpoint=s.mcp_oauth_url);let i=z,l=!1;"edit"===L?(i=await ea({connectionId:z.id,connectionName:r,connectionInfo:s,publicKey:A,abortSignal:n.signal}))&&O(i):(i=await eo({connectionInfo:s,connectionName:r}),l=!0,i?.id&&(I("edit"),O(i))),i?.mcp_oauth_url&&await en(i.mcp_oauth_url),i?.snowflake_oauth_url&&await en(i.snowflake_oauth_url),ef("data_connection_pizza_tracker"),ep({connectionName:e?.name});try{await eh.mutateAsync({connectionId:i.id,waitForSchema:!0,onMessage:e=>{ep(t=>({...t,connectionStatus:e}))}})}catch(e){if(l&&i?.id){try{await ex({connectionId:i.id})}catch{}O(null),I("create")}throw e}ef(null),ep({}),X(null);let o=es?.id||ec?.id||i?.id;o?S.push(`/chat?connectionId=${o}`):G(!0)}catch(e){throw X(null),e}},[ej,ev]=(0,n.useState)(null),ey=()=>{G(!1),p(!1),J({}),O(null),I("create"),em(),el(),"edit"===L&&_.invalidateQueries({queryKey:(0,o.getUserConnectionsQueryKey)()})},eb=er||ed||null!==Z,eN=(0,n.useMemo)(()=>(0,a.customizeValidator)({customFormats:{"unique-connection-name":e=>R(e)}}),[P,L,R]),[ew,eC]=(0,n.useState)(j?.custom_instructions||""),ek=j?.learned_information||"",eS=(0,n.useMemo)(()=>{if(!ek)return!1;try{let e="string"==typeof ek?JSON.parse(ek):ek;return e?.freeze===!0}catch{return!1}},[ek]),[e_,eA]=(0,n.useState)(!1),{mutateAsync:eT}=(0,o.useUpdateConnectionCustomInstructions)(),eD=async()=>{if(j?.id){eA(!0);try{await eT({connectionId:j.id,customInstructions:ew}),j&&(j.custom_instructions=ew),z&&O({...z,custom_instructions:ew}),l.toast.success("Custom instructions updated successfully!")}catch(e){l.toast.error("Failed to update custom instructions"),console.error("Error updating custom instructions:",e)}finally{eA(!1)}}};return Y?(0,t.jsx)(u.Dialog,{open:f,onOpenChange:ey,children:(0,t.jsxs)(u.DialogContent,{className:"sm:max-w-[1100px] max-h-[85vh] flex flex-col",children:[(0,t.jsxs)("div",{className:"flex-shrink-0",children:[(0,t.jsxs)(u.DialogHeader,{className:"text-center",children:[(0,t.jsx)(u.DialogTitle,{className:"text-xl",children:"edit"===L?"Connection updated":"Connector created"}),(0,t.jsx)(u.DialogDescription,{children:"edit"===L?"Your connection was updated successfully!":"Your connection was successful!"})]}),(0,t.jsxs)("div",{className:"bg-muted/30 rounded-lg p-4 flex items-center gap-4 mt-4",children:[e?.light_logo_url&&(0,t.jsx)(r.default,{src:e?.light_logo_url,alt:e?.name,width:32,height:32,className:"h-8 w-8 object-contain flex-shrink-0"}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("div",{className:"font-medium text-foreground truncate",children:z?.name||e.name}),(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Connected to ",e.name]})]}),(0,t.jsx)("div",{className:"flex-shrink-0",children:(0,t.jsx)("div",{className:"w-6 h-6 rounded-full bg-green-100 flex items-center justify-center",children:(0,t.jsx)("svg",{className:"w-4 h-4 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})})]})]}),(0,t.jsx)("div",{className:"flex-shrink-0 pt-6 border-t border-border mt-6",children:(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)(d.Button,{variant:"outline",onClick:ey,className:"flex-1",children:"Go to Settings"}),(0,t.jsx)(d.Button,{onClick:()=>{let e=es?.id||ec?.id;e&&S.push(`/chat?connectionId=${e}`)},className:"flex-1",children:"Try it out"})]})})]})}):e?(0,t.jsxs)(u.Dialog,{open:f,onOpenChange:e=>{e&&(I("create"),O(null),J({}),em(),el()),p(e)},children:[(0,t.jsx)(u.DialogTrigger,{asChild:!0,children:v}),(0,t.jsx)(u.DialogContent,{className:"sm:max-w-[800px] md:min-h-[640px] max-h-[90vh] flex flex-col",children:(0,t.jsxs)(m.Tabs,{defaultValue:y,className:"w-full flex-1 flex flex-col min-h-0",children:["edit"===L&&(0,t.jsxs)(m.TabsList,{className:"mb-2 mr-12",children:[(0,t.jsx)(m.TabsTrigger,{value:"connection",children:"Connection"}),(0,t.jsx)(m.TabsTrigger,{value:"customInstructions",children:"Custom Instructions"}),(0,t.jsx)(m.TabsTrigger,{value:"learnedInformation",children:"Learned Information"}),(0,t.jsx)(m.TabsTrigger,{value:"filteredSchema",children:"Filtered Schema"}),(0,t.jsx)(m.TabsTrigger,{value:"dataDictionary",children:"Data Dictionary"})]}),(0,t.jsx)(m.TabsContent,{value:"connection",className:"w-full flex-1 flex flex-col h-full min-h-0 data-[state=inactive]:hidden",children:(0,t.jsx)(C,{connector:e,internalMode:L,availableModes:q,selectedMode:U,setSelectedMode:W,currentError:ei||eu,schemaWithConnectionName:ee,formData:V,setFormData:J,uiSchema:et,validator:eN,transformErrors:E,handleChange:e=>{J(e.formData);let t=null,n=e?.formData?.host;if("string"==typeof n&&n.trim().length>0){let e=n.trim().toLowerCase();("localhost"===e||"127.0.0.1"===e)&&(t="We don't support localhost endpoints for MCP connectors, please use a public endpoint instead")}let a=e?.formData?.endpoint;if(!t&&"string"==typeof a){let e=a.toLowerCase();e.length>=8&&(e.includes("sse")?t="We don't support SSE endpoints for MCP connectors, please use an HTTPS endpoint instead":e.includes("ws")||e.includes("wss")?t="We don't support WebSocket endpoints for MCP connectors, please use an HTTPS endpoint instead":e.startsWith("https://")||(t="Please use a valid HTTPS endpoint (e.g., https://your-server.com/mcp)"))}ev(t)},handleSubmit:eg,isProcessing:eb,handleCancel:()=>{Z&&(Z.abort("User cancelled connection test"),X(null))},existingConnection:j,warning:ej,documentationUrl:N??(0,x.getConnectorDocsUrl)(e)})}),"edit"===L&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(m.TabsContent,{value:"learnedInformation",className:"w-full flex-1 flex flex-col h-full min-h-0",children:(0,t.jsx)(M,{connectionId:z?.id,isFrozen:eS,teamId:B})}),(0,t.jsx)(m.TabsContent,{value:"customInstructions",className:"w-full",children:(0,t.jsx)(k.default,{customInstructions:ew,setCustomInstructions:eC,isSaving:e_,handleSave:eD,existingCustomInstructions:j?.custom_instructions})}),(0,t.jsx)(m.TabsContent,{value:"filteredSchema",className:"w-full",children:(0,t.jsx)(F,{connectionId:z?.id})}),(0,t.jsx)(m.TabsContent,{value:"dataDictionary",className:"w-full",children:(0,t.jsx)(D,{connectionId:z?.id,initialDataDictionary:j?.data_dictionary_raw_text})})]})]})})]}):(0,t.jsx)(u.Dialog,{open:f,onOpenChange:p,children:(0,t.jsxs)(u.DialogContent,{className:"sm:max-w-[425px]",children:[(0,t.jsx)(u.DialogHeader,{children:(0,t.jsx)(u.DialogTitle,{children:"Loading..."})}),(0,t.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,t.jsx)("div",{className:"w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin"})})]})})}],413801)},934357,e=>{"use strict";var t=e.i(52563),n=e.i(954616),a=e.i(266027),s=e.i(912598),r=e.i(948822);e.s(["useDisconnectMicrosoftAccount",0,e=>{let{getAccessTokenSilently:a}=(0,t.useAuth0)(),i=(0,s.useQueryClient)();return(0,n.useMutation)({mutationFn:async()=>{let t=await a();return(0,r.disconnectMicrosoftAccount)(t,e)},onSuccess:()=>{i.invalidateQueries({queryKey:["microsoft-oauth-token",e]})}})},"useMicrosoftOauthToken",0,e=>{let{getAccessTokenSilently:n}=(0,t.useAuth0)();return(0,a.useQuery)({queryKey:["microsoft-oauth-token",e],queryFn:async()=>{let t=await n();return(0,r.getMicrosoftOauthToken)(t,e)},refetchInterval:e=>{let t=e.state.data?.expires_at;if(!t)return!1;let n=new Date(t).getTime()-Date.now()-3e4;return n>0?n:0},refetchIntervalInBackground:!0,refetchOnWindowFocus:!1,staleTime:1/0})}])}]);

//# debugId=9d7843fa-128b-c69f-7643-5b41f4bc1b51
//# sourceMappingURL=7599f9ef9cfd5435.js.map